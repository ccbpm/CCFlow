<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>流程待办</title>
		<!-- basic styles -->

		<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="assets/css/font-awesome.min.css" />

		<!--[if IE 7]>
		  <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css" />
		<![endif]-->

		<!-- page specific plugin styles -->

		<!-- fonts -->

		<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,300" />

		<!-- ace styles -->

		<link rel="stylesheet" href="assets/css/ace.min.css" />
		<link rel="stylesheet" href="assets/css/ace-rtl.min.css" />
		<link rel="stylesheet" href="assets/css/ace-skins.min.css" />

		<!--[if lte IE 8]>
		  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->

		<!-- inline styles related to this page -->

		<!-- ace settings handler -->

		<script src="assets/js/ace-extra.min.js"></script>

		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

		<!--[if lt IE 9]>
		<script src="assets/js/html5shiv.js"></script>
		<script src="assets/js/respond.min.js"></script>
		<![endif]-->

    <script type="text/javascript" src="../WF/Scripts/bootstrap/js/jquery.min.js"></script>
    <script src="../WF/Scripts/QueryString.js" type="text/javascript"></script>
    <!-- 引用通用的js文件. -->
    <script type="text/javascript" src="../WF/Comm/Gener.js"></script>
    <script type="text/javascript" src="../WF/Scripts/config.js"></script>
    <script type="text/javascript" language="javascript" >
        //获取当前时间
        function getNowFormatDate() {
            var date = new Date();
            var seperator1 = "-";
            var seperator2 = ":";
            var month = date.getMonth() + 1;
            var strDate = date.getDate();
            if (month >= 1 && month <= 9) {
                month = "0" + month;
            }
            if (strDate >= 0 && strDate <= 9) {
                strDate = "0" + strDate;
            }
            //当前时间=年份-月份-日 小时：分钟
            var cdt = date.getFullYear() + seperator1 + month + seperator1 + strDate
            + " " + date.getHours() + seperator2 + date.getMinutes();

            return cdt;
        }

        //页面启动函数.
        $(function () {

            $.ajax({
                type: 'post',
                async: true,
                url: Handler + "?DoType=Todolist_Init&m=" + Math.random(),
                dataType: 'html',
                success: function (data) {

                    if (data.indexOf('err@') == 0) {
                        alert(data);
                        return;
                    }

                    var timeKey = '';


                    //转换.
                    data = JSON.parse(data);

                    var cdt = getNowFormatDate();

                    var newRow = "";
                    for (var i = 0; i < data.length; i++) {

                        var title = data[i].TITLE;
                        var isRead = data[i].ISREAD;
                        var flowNo = data[i].FK_FLOW;
                        var flowName = data[i].FLOWNAME;
                        var nodeName = data[i].NODENAME;
                        var starterName = data[i].STARTERNAME;
                        var pri = data[i].PRI;
                        var nodeID = data[i].FK_NODE;
                        var fid = data[i].FID;
                        var workID = data[i].WORKID;
                        var pWorkID = data[i].PWORKID;
                        var paras = data[i].ATPARA;

                        newRow += "<tr > <td>" + (i + 1) + "</td>"; //序号
                        newRow += "<td><img class=Icon src='../WF/Img/PRI/" + pri + ".png' class=Icon /></td>"; //优先级
                        var url = "";
                        if (isRead == 0) {
                            url = "<a href=\"javascript:OpenFlow('../WF/MyFlow.htm?FK_Flow=" + flowNo + "&PWorkID=" + pWorkID + "&FK_Node=" + nodeID + "&FID=" + fid + "&WorkID=" + workID + "&IsRead=0&T=" + timeKey + "&Paras=" + paras + "');\" ><img class=Icon align='middle'  src='../WF/Img/Mail_UnRead.png' />" + title + "</a>";
                        } else {
                            url = "<a href=\"javascript:OpenFlow('../WF/MyFlow.htm?FK_Flow=" + flowNo + "&PWorkID=" + pWorkID + "&FK_Node=" + nodeID + "&FID=" + fid + "&WorkID=" + workID + "&IsRead=0&T=" + timeKey + "&Paras=" + paras + "');\" ><img class=Icon align='middle'  src='../WF/Img/Mail_Read.png' />" + title + "</a>";
                        }

                        newRow += "<td>" + url + "</td>"; //标题
                        newRow += "<td>" + flowName + "</td>"; //流程类别
                        newRow += "<td>" + nodeName + "</td>"; //节点名称
                        newRow += "<td>" + starterName + "</td>"; //待办人


                        newRow += "<td>" + data[i].RDT + "</td>"; //待办时间
                        newRow += "<td>" + data[i].ADT + "</td>"; //接受时间
                        newRow += "<td>" + data[i].SDT + "</td>"; //应完成时间
                        //判断流程是否逾期
                        if (cdt > data[i].SDT && data[i].WFSTATE == 2) {
                            newRow += "<td><img src='../WF/Img/TolistSta/2.png' class='Icon'/><font color=red>逾期</font></td>";
                        }
                        else {
                            newRow += "<td><img src='../WF/Img/TolistSta/0.png' class='Icon'/><font color=green>正常</font></td>";
                        }
                        //待办的状态.
                        switch (data[i].WFSTATE) {
                            case 1:
                                newRow += "<td>草稿</td>";
                                break;
                            case 2:
                                newRow += "<td>待办</td>";
                                break;
                            case 3: //已完成.
                                break;
                            case 4:
                                newRow += "<td>挂起</td>";
                                break;
                            case 5:
                                newRow += "<td>退回</td>";
                                break;
                            case 6:
                                newRow += "<td>转发</td>";
                                break;
                            case 7:
                                newRow += "<td>删除</td>";
                                break;
                            case 8:
                                newRow += "<td>加签</td>";
                                break;
                            case 11:
                                newRow += "<td>加签回复</td>";
                                break;
                            default:
                                newRow += "<td>其他</td>";
                                break;
                        }
                        //备注
                        newRow += "<td width='100'><div style='width:100px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;' title='" + data[i].FLOWNOTE + "'>" + data[i].FLOWNOTE + "</div></td>";
                        newRow += "</tr>";
                    }
                    $("#Rows").html(newRow);
                    return;
                }
            });
        });

        function OpenFlow(url) {
            window.open(url, "_");
            return;
        }
    </script>
	</head>
	<body>
		<div class="main-container" id="main-container">
					<div class="breadcrumbs" id="breadcrumbs">
						<ul class="breadcrumb">
							<li>
								<i class="icon-home home-icon"></i>
								<a href="welcome.htm">Home</a>
							</li>
							<li class="active">待办</li>
						</ul><!-- .breadcrumb -->

						<div class="nav-search" id="nav-search">
							<form class="form-search">
								<span class="input-icon">
									<input type="text" placeholder="查找 ..."  class="nav-search-input" id="nav-search-input" autocomplete="off" />
									<i class="icon-search nav-search-icon"></i>
								</span>
							</form>
						</div><!-- #nav-search -->
					</div>

						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->

								<div class="row">
									<div class="col-xs-12">
										<div class="table-responsive">
											<table id="sample-table-1" class="table table-striped table-bordered table-hover">
												<thead>
													<tr>

                                                    <th>序</th>
<th>优先级</th>
<th>标题</th>
<th>流程</th>
<th>节点</th>
<th>待办人</th>
<th>待办日期</th>
<th>接受日期</th>
<th><i class="icon-time bigger-110 hidden-480"></i>应完成日期</th>
<th>状态</th>
<th>类型</th>
<th>备注</th>

													 
													</tr>
												</thead>

												<tbody id="Rows">
												</tbody>

											</table>
										</div><!-- /.table-responsive -->
									</div><!-- /span -->
								</div><!-- /row -->

								<div class="hr hr-18 dotted hr-double"></div>
							</div><!-- /.col -->
						</div><!-- /.row -->
		 
		</div><!-- /.main-container -->

		<!-- basic scripts -->

		<!--[if !IE]> -->

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

		<!-- <![endif]-->

		<!--[if IE]>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<![endif]-->

		<!--[if !IE]> -->

		<script type="text/javascript">
		    window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>" + "<" + "/script>");
		</script>

		<!-- <![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->
 


</body>
</html>
