<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">-->
    <title>抄送</title>
     
    <link href="js/mui/css/mui.min.css" rel="stylesheet" type="text/css" />
    <!--<link href="js/mui/css/mui.indexedlist.css" rel="stylesheet" type="text/css" />-->
    <script src="./js/mui/js/mui.min.js" type="text/javascript"></script>
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="js/comment/action.js" type="text/javascript"></script>
    <script src="js/WorkOpt/Start.js" type="text/javascript"></script>
    <script src="./Scripts/config.js" type="text/javascript"></script>
    <script src="./Comm/Gener.js" type="text/javascript"></script>
    <script src="./Scripts/QueryString.js" type="text/javascript"></script>
    <style type="text/css">

    </style>
    <script type="text/javascript">
        mui.init();
        mui.ready(
        //加载数据
	        function Load_EmpWorks() {
                //apk模式待用，勿删
				 if(mui.os.android){ 	//注意，这里是小写的android
	        	
	        	 }else{
	        	 	$("#header").css("height","95px");
	        	 	$("#topTitle").css("margin-top","45px");
	        	     $("#aback").css("margin-top","45px");
	        	 	$("#div_list").css("margin-top","50px");
	        	
	        	 }
                var handler = new HttpHandler("BP.WF.HttpHandler.WF");
                var pushData = handler.DoMethodReturnString("CC_Init");
                //转换.
                if (pushData.indexOf('err@') == 0) {
                    alert(pushData);
                    return;
                }

                pushData = cceval('(' + pushData + ')');
	            $("#LV_CClist").empty();
	            var _Html = "";
	            var flowNames = "";

	            //判断是否有数据
	            if (pushData.length == 0) {
	            	 mui.alert("记录为空！", function () {
                         SetHref('./Home.htm?s=' + Math.random());
		                });
	            }

	            for (var k = 0; k < pushData.length; k++) {
	                if (flowNames.indexOf(pushData[k].FlowName) > -1)
	                    continue;
	                flowNames += pushData[k].FlowName + ",";
	            }

	            var flowName_Arrary = flowNames.split(",");
	            for (var j = 0; j < flowName_Arrary.length; j++) {
	                if (flowName_Arrary[j] == "")
	                    continue;
					_Html += "<li class='mui-table-view-cell mui-collapse mui-active' style=''><a class='mui-navigate-right' href='#' style='padding-left: 28px;'>" + flowName_Arrary[j] + "</a>";
	                _Html += "<ul class='mui-table-view mui-table-view-chevron'>";
	                for (var i = 0; i < pushData.length; i++) {
	                    if (pushData[i].FlowName != flowName_Arrary[j])
	                        continue;

	                    var en = pushData[i];

	                    var fk_flow = en.FK_Flow;
	                    var fk_node = en.FK_Node;
	                    var workid = en.WorkID;
	                    var fid = en.FID;
	                    var isRead = en.IsRead;
	                    var paras = en.AtPara;
	                    if (paras == null || paras == "") {
	                        paras = "";
	                    }
	                    else {
	                        if (paras.indexOf("IsCC=1") > -1) {
	                            paras = "IsCC=1";
	                        } else {
	                            paras = "";
	                        }
	                    }

	                    var href = "MyView.htm?FK_Flow=" + fk_flow + "&From=CC&FK_Node=" + fk_node + "&WorkID=" + workid + "&FID=" + fid + "&IsRead=0&Paras=" + paras + "&T=" + Math.random();

						_Html += "<li  class='mui-table-view-cell' style='padding-left: 22px'>";
	                    _Html += "   <a href='" + href + "' target='_self'>";
	                    _Html += "      <h5 style=\"color:#096BC1;\">" + en.Title + "</h5>";
	                    _Html += "      <h6  style='float:left' >当前节点：" + en.NodeName + " - " + en.Rec +  "</h6>";
	                    _Html += "      <h6 style='float:right'>抄送日期:" + en.RDT + "</h6>";

	                    //退回
	                    if (pushData[i].WFState == "5") {
	                        _Html += DB_ReturnWorks(fk_node, workid);
	                    }

	                    _Html += "  </a>";
	                    _Html += "</li>";
	                }
	                _Html += "  </ul>";
	                _Html += "</li>";
	            }

	            //展显
	            $("#LV_CClist").html("");
	            $("#LV_CClist").append(_Html);
	        

	        }
        
        );
	

       function Back() {
           SetHref('../CCMobilePortal/Home.htm?s=' + Math.random());
            return;
        }
    </script>
</head>
<body>
     <header class="mui-bar mui-bar-nav" id='header'>
		<a class="mui-icon mui-icon-left-nav mui-pull-left" id='aback' href="javascript:Back();"></a>
		<h1 class="mui-title" id='topTitle'>抄送</h1>
	</header>
    <div class="mui-content">
        <div class="mui-scroll-wrapper" id='div_list'>
			<div class="mui-scroll" >
                <ul id="LV_CClist" class="mui-table-view mui-table-view-chevron" ></ul>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
    //初始化单页的区域滚动
     mui('.mui-scroll-wrapper').scroll({
				bounce:false
			});
</script>
</html>
