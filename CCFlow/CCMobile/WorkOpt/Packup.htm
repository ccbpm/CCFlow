<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>打包下载</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../css/themes/default/jquery.mobile-1.4.5.min.css" rel="stylesheet" type="text/css" />
    <link href="../css/themes/classic/theme-classic.css" rel="stylesheet" type="text/css" />
    <script src="../js/jquery.js" type="text/javascript"></script>
    <script src="../js/jquery.mobile-1.4.5.min.js" type="text/javascript"></script>
    <script src="../Scripts/config.js" type="text/javascript"></script>
    <script src="../Comm/Gener.js" type="text/javascript"></script>
    <script src="../Scripts/QueryString.js" type="text/javascript"></script>
    <script type="text/javascript" src="../Scripts/bootstrap/js/jquery.cokie.min.js"></script>
    <script type="text/javascript">

        $(function () {

            var fileTypes = GetQueryString("FileType");
            // 初始化人员.   .开始加载数据.

            var handler = new HttpHandler("BP.WF.HttpHandler.CCMobile_WorkOpt");
            handler.AddPara("FileType", GetQueryString("FileType"));
            handler.AddPara("FK_Node", GetQueryString("FK_Node"));
            handler.AddPara("FK_Flow", GetQueryString("FK_Flow"));
            handler.AddPara("WorkID", GetQueryString("WorkID"));
            handler.AddPara("FID", GetQueryString("FID"));
            var data = handler.DoMethodReturnString("Packup_Init");


            if (data.indexOf('err@') == 0) {
                document.getElementById("Msg").innerHTML = data;
                return;
            }

            var filetype = GetQueryString("FileType");
            var urls = JSON.parse(data);
            var html = "";
            for (var i = 0; i < urls.length; i++) {

                var url = urls[i];
                if (fileTypes.indexOf(url.No) < 0 )
                    continue;

                if (url.No == "htm" || url.No == "html") {
                    html += "<fieldset>";
                    html += "<legend>html在线预览打印</legend>";
                    html += "<ul>";
                    html += "<li>系统把整个表单生成了一个静态的html文件.</li>";
                    html += "<li>点击这里<a href=" + url.Name + " target=_blank ><img src='../Img/FileType/htm.gif' />进行在线预览</a></li>";
                    html += "</ul>";
                    html += "</fieldset>";

                    SetHref( url.Name);
                    return;
                }

                if (url.No == "pdf") {

                    if (url.Name.indexOf('err@') == 0) {
                        html += "<fieldset>";
                        html += "<legend>pdf 生成pdf出现错误</legend>";
                        html += "<font color=red>" + url.Name + "</font>";
                        html += "</fieldset>";
                    } else {
                        html += "<fieldset>";
                        html += "<legend>pdf 在线打印与预览</legend>";
                        html += "<ul>";
                        html += "<li>系统把整个表单生成了一个pdf文件.</li>";
                        html += "<li>点击这里<a href=" + url.Name + " target=_blank ><img src='../Img/FileType/pdf.gif' />进行下载与在线预览</a></li>";
                        html += "</ul>";
                        html += "</fieldset>";

                        downloadFile(url.Name);
                        return;
                    }
                }

                if (url.No == "zip") {

                    if (url.Name.indexOf('err@') == 0) {
                        html += "<fieldset>";
                        html += "<legend>生成zip出现错误</legend>";
                        html += "<font color=red>" + url.Name + "</font>";
                        html += "</fieldset>";
                    } else {
                        html += "<fieldset>";
                        html += "<legend>zip 在线打印与预览</legend>";
                        html += "<ul>";
                        html += "<li>系统把整个表单生成了一个zip文件,这个文件里包括了,表单的附件，二维码等信息.</li>";
                        html += "<li>点击这里<a href=" + url.Name + " target=_blank ><img src='../Img/FileType/Zip.gif' />进行打包下载</a></li>";
                        html += "</ul>";
                        html += "</fieldset>";

                        SetHref( url.Name);
                        return;
                    }
                }
            }

           document.getElementById("Msg").innerHTML = html;
//           
        });

        function Back() {
            window.history.go(-1);
           
        }
    </script>

    <style type="text/css">
        #tb_msg
        {
            height: 72px;
            width: 272px;
        }
    </style>
</head>
<body>

 <div data-role="page" data-theme="d" id="return-page">
        
        <div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme="b">
        <h2  onclick="javascript:Back()" >下载/打印</h2>
            <a href="javascript:Back()" target="_self" data-icon="carat-l" data-iconpos="notext">下载/打印</a>
        </div>
 
 <div id="Msg"><img src='../Img/loading.gif' />正在加载请稍候... </div>


 </div>

</body>
</html>
