<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>移交</title>
    <!--
    1, 加签界面。
    2，需要 FK_Flow, FK_Node,WorkID, FID.
    3, 调用方法 ReturnWork.htm?FK_Flow=001&FK_Node=103&WorkID=232&FID=23
    -->
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="white">

    <link href="../js/mui/css/mui.css" rel="stylesheet" type="text/css" />
    <script src="../js/jquery.js" type="text/javascript"></script>
    <script src="../js/mui/js/mui.min.js" type="text/javascript"></script>

    <script src="../Scripts/config.js" type="text/javascript"></script>
    <script src="../Scripts/QueryString.js" type="text/javascript"></script>
    <script src="../Comm/Gener.js" type="text/javascript"></script>
     <script type="text/javascript" src="../Scripts/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../Scripts/bootstrap/js/jquery.cokie.min.js"></script>

    <script type="text/javascript">
        var param = {};
        $(function () {
            //初始化页面移交页面
            param = {
                FK_Node: GetQueryString('FK_Node'),
                WorkID: GetQueryString('WorkID'),
                FID: GetQueryString('FID'),
                Message: GetQueryString('Info'),
                FK_Flow: GetQueryString("FK_Flow"),
                selectNo:GetQueryString("Select_No"),
                selectName:GetQueryString("Select_Name")
            };
            var dept = getQueryStringByNameFromUrl("?" + $.cookie('CCS'), "FK_Dept");
            if (dept == null || dept == '' || dept == undefined) {
                dept = $.cookie('FK_Dept');
            }

            if (dept == null || dept == '' || dept == undefined) {
                var u = new WebUser();
                dept = u.FK_Dept;
            }

            if (dept == undefined) {
                dept = "0";
            }

            if(param.selectName!=null && param.selectName!=undefined)
                $("#ToEmp").val(param.selectName);
            //初始化人员选择窗口
            var url = "SelectEmps.htm?FK_Dept=" + dept + "&s=" + Math.random();
            url += "&WorkID=" + GetQueryString("WorkID") + "&FK_Flow=" + GetQueryString("FK_Flow") + "&FK_Node=" + GetQueryString("FK_Node") +"&PageName=Shift&PageFrom="+GetQueryString("PageFrom") ;

            $('#BtnSelectEmps').bind('click', function () {
                SetHref(url);
            });

        });

        //确定  执行移交操作
        function ShiftWork() {
            var empNos = param.selectNo;
            if (empNos == null || empNos == ""){
                mui.alert("选择移交人");
                return;
            }
            var handler = new HttpHandler("BP.WF.HttpHandler.WF_WorkOpt");
            handler.AddPara("FK_Flow", param.FK_Flow);
            handler.AddPara("WorkID", param.WorkID);
            handler.AddPara("FID", param.FID);
            handler.AddPara("FK_Node", param.FK_Node);
            handler.AddPara("ToEmp", empNos);
            handler.AddPara("Message", $('#Message').val());

            var data = handler.DoMethodReturnString("Shift_Save");
            data = data.replace("@null", "");
    		mui.toast(data);
            Back();
           
        }

        //取消移交
        function Close() {
            if (window.parent != null && window.parent.returnWorkWindowClose != null) {
                window.parent.returnWorkWindowClose("取消");
            } else {
                $('body').append($('<div>' + "已取消操作" + '</div>'));
                window.close();
            }
        }
        
        function Back() {
            var pageFrom = GetQueryString("PageFrom") || "";
            if (pageFrom == "En")
                BackToHome();
            else
                BackToWork();
        }
        
      //返回我的工作.
        function BackToWork() {

            var url = "../MyFlow.htm?WorkID=" + GetQueryString("WorkID") + "&FK_Flow=" + GetQueryString("FK_Flow") + "&FK_Node=" + GetQueryString("FK_Node");
            SetHref(url);
        }
        function BackToHome() {
            SetHref('../../CCMobilePortal/Home.htm?UserNo=' + GetQueryString('UserNo') + "&Token=" + GetQueryString("Token"));
        }
        function BackTolist() {
            var url = "../Todolist.htm?WorkID=" + GetQueryString("WorkID") + "&FK_Flow=" + GetQueryString("FK_Flow") + "&FK_Node=" + GetQueryString("FK_Node");
            SetHref(url);
        }

    </script>
</head>
<body>
    <header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" ></a>
		<h1 class="mui-title">请选择要移交的人</h1>
    </header>
    <nav class="mui-bar mui-bar-tab">
        <a class="mui-tab-item" href="#" onclick="ShiftWork()">确定移交</a>
		<a class="mui-tab-item" href="#" onclick="Back()">返回</a>
        <a class="mui-tab-item" href="#" onclick="BackTolist()">返回待办</a>
    </nav>
    <div class="mui-content">
        <div class="mui-scroll-wrapper">
			<div class="mui-scroll">
                <div class="title" style="margin-top:50px">接受人</div>
                <div class="mui-input-row" style="margin-top: 10px;">
                    <input  type="text" id="ToEmp" name="ToEmp" class="mui-input-clear" placeholder="选择移交人" readonly/>
                </div>
                    <button type="button" id="BtnSelectEmps" class="mui-btn mui-btn-success mui-icon mui-icon-plus" style="width:100%;background-color:#4cd9647a;border-color:#4cd9647a">选择移交人</button>
                    
                <div class="title" style="margin-top:10px">移交原因</div>
                <div class="mui-input-row" style="margin: 10px 5px;">
                    <textarea  name="Message" id="Message"  rows="5" placeholder="输入移交原因"></textarea>
                </div>
               
   	       </div>       
    </div>
  </div> 
</body>
<script type="text/javascript">
    //初始化单页的区域滚动
    mui('.mui-scroll-wrapper').scroll();
</script>
</html>
