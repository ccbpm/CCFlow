<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
	<title>延续子流程</title>
	 <link href="../../Comm/Style/CommStyle.css" rel="stylesheet" type="text/css" />
    <link href="../../../DataUser/Style/ccbpm.css" rel="stylesheet"  type="text/css" />
    <link href="../../Scripts/easyUI/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <link href="../../Scripts/easyUI/themes/icon.css" rel="stylesheet" type="text/css" />
    <script src="../../Scripts/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="../../Scripts/easyUI/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../../Scripts/QueryString.js" type="text/javascript"></script>
    <script type="text/javascript" src="../../Scripts/config.js"></script>
    <script type="text/javascript" src="../../Comm/Gener.js"></script>
    <script src="../../Scripts/EasyUIUtility.js" type="text/javascript"></script>

	<base target="_self" />
	<script type="text/javascript">

	    //页面启动函数.
	    $(function () {

	        $("#Msg").html("<img src=../../Img/loading.gif />&nbsp;正在加载,请稍后......");

	        //求出来已经设置的延续子流程.
	        var nodeID = GetQueryString("FK_Node");
	        var orgNo = GetQueryString("OrgNo");

	        //查询出来数据.
	        var sql = "SELECT A.No AS SortNo, A.Name as SortName, b.No, b.Name ";
	        sql += " FROM WF_FlowSort a, WF_Flow b WHERE (A.OrgNo='" + orgNo + "' OR A.ParentNo='" + orgNo + "') AND A.No=B.FK_FlowSort ";
	        sql += " ORDER BY A.Idx, b.Idx ";

	        //获得要增加的流程集合.
	        var dt = DBAccess.RunUrlReturnJSON(sql);

	        var html = "";
	        for (var i = 0; i < dt.length; i++) {
	            var en = ens[i];
	            html += "<tr>";
	            html += "<td>" + en.SortName + "</td>";
	            html += "<td>" + en.Name + "</td>";
	            html += "<td><a href=\"javascript:CheckIt('" + en.No + "');\" >选择</a></td>";
	            html += "</tr>";
	        }

	        $("#Msg").html("");

	    });


	    function CheckIt(flowNo) {

	        var ens = new Entities("BP.WF.Template.NodeYGFlows");
	        ens.Retrieve("FK_Node", nodeID, "FK_Flow", flowNo);
	        if (ens.length == 1) {
	            alert("该流程已经存在");
	            return;
	        }

	        var en = new Entity("BP.WF.Template.NodeYGFlow");
	        en.FK_Flow = flowNo;
	        en.FK_Node = GetQueryString("FK_Node");
	        en.Insert();

	        window.close();
	    }
         
    </script>
</head>
<body>
	<table id="Table1" style="width: 100%">
		
        <caption>延续子流程 <a href="javascript:AddGroup()">增加集团子流程</a>|<a href="javascript:AddOrg()">增加本组织子流程</a></caption>

        <tr>
        <th>流程类别</th>
        <th>名称</th>
        <th>选择</th>
        </tr>
		 
	</table>
    <br />

				<button  id="Btn_Save" onclick="Save()">
					保存</button>


	<div id="Msg">
	</div>

    <fieldset>
					<legend>填写帮助</legend>
					<ul>
						<li></li>
					</ul>
				</fieldset>
</body>
</html>
