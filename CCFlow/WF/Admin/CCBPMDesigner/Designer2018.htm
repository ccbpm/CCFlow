<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="../../Scripts/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="../../Scripts/QueryString.js" type="text/javascript"></script>
    <script src="../../Scripts/config.js" type="text/javascript"></script>
    <script src="../../Comm/Gener.js" type="text/javascript"></script>
    
    <script language="javascript" type="text/javascript" >
    
         var flowNo = "001";
       //页面启动函数.
        $(function () {

            $("#Msg").html("<img src=../../Img/loading.gif />&nbsp;正在加载,请稍后......");

            InitPage();

            $("#Msg").html("");
        });

        function InitPage() {

             flowNo = GetQueryString("FK_Flow");
            if (flowNo == null || flowNo == undefined)
                flowNo = "001";

            //节点.
            var nodes = new Entities("BP.WF.Nodes");
            nodes.Retrieve("FK_Flow", flowNo);

            //标签.
            var labs = new Entities("BP.WF.Template.LabNotes");
            labs.Retrieve("FK_Flow", flowNo);

            //方向.
            var dirs = new Entities("BP.WF.Template.Directions");
            dirs.Retrieve("FK_Flow", flowNo);
        }

        //创建节点,返回节点名称与节点ID.
        function NewNode(x, y) {

            var hander = new HttpHandler("BP.WF.HttpHandler.WF_Admin_CCBPMDesigner2018");
            hander.AddPara("X",x);
            hander.AddPara("Y", y);
            hander.AddPara("FK_Flow", flowNo);

            var json = hander.DoMethodReturnJSON("CreateNode");
            var nodeID = json.NodeID;
            var name = json.Name;
            return true;
        }

        //删除节点.
        function DeleteNode(nodeID) {

            //节点.
            var hander = new HttpHandler("BP.WF.HttpHandler.WF_Admin_CCBPMDesigner2018");
            hander.AddPara("FK_Node", nodeID);
            var data = hander.DoMethodReturnString("DeleteNode");
            if (data.indexOf('err@') == 0) {
                alert(data); //删除失败的情况.
                return;
            }
        }

        //保存信息.
        function Save() {

            //节点.
            var nodes = new Entities("BP.WF.Nodes");
            nodes.Retrieve("FK_Flow", flowNo);

            //节点更新 , 更新位置信息.
            for (var i = 0; i < nodes.length; i++) {

                var nodeJson = nodes[i];
                var node = new Entity("BP.WF.Node", nodeJson);
               // node.Name = "sss";
                node.Update();
            }

            // lab 更新,位置与文本信息.

            //连接线更新,先删除在更新.

        }
     </script>
</head>
<body>

</body>
</html>
