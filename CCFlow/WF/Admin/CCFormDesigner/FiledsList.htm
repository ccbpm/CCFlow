<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>字段列表</title>
	<link href="/WF/Comm/Style/Table0.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="/WF/Comm/JScript.js"></script>
	<script type="text/javascript" src="/WF/Scripts/bootstrap/js/jquery.min.js"></script>
	<script type="text/javascript" src="/WF/Scripts/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/WF/Scripts/QueryString.js"></script>
	<script type="text/javascript" src="/WF/Scripts/config.js"></script>
	<base target="_self" />

	<script type="text/javascript" >
		/* ESC Key Down */
		function Esc() {
			if (event.keyCode == 27)
				window.close();
			return true;
		}

		//页面启动函数.
		$(function () {
			$("#Msg").html("正在加载,请稍后......");
			InitPage();
			$("#Msg").html("");
		});

		//初始化数据.
		function InitPage() {
			var FK_MapData = GetQueryString("FK_MapData");
			//初始化表格.
			$.ajax({
				type: 'post',
				async: true,
				url: Handler + "?DoType=FiledsList_Init&FK_MapData=" + FK_MapData + "&m=" + Math.random(),
				dataType: 'html',
				success: function (data) {
					if (data.indexOf("err@") > -1) {
						alert(data);
					} else {
						$("#Msg").html(data);

						data = JSON.parse(data);
						//增加处理.
						var newRow;
						var normalFieldRows, enumFieldRows,fkFieldRows;
						for (var i in data.Sys_MapAttr) {
							newRow = "";
							/*<th>序号</th>
							<th>字段名</th>
							<th>中文名</th>
							<th>类型</th>
							<th>长度</th>
							<th>关联</th>
							<th>编辑</th>*/
							newRow = "<tr ><td class=Idx>" + i + "</td>";
							//newRow += "<td>" + data.Sys_MapAttr[i].MyPK + "</td>";
							newRow += "<td>" + data.Sys_MapAttr[i].KeyOfEn + "</td>";
							newRow += "<td>" + data.Sys_MapAttr[i].Name + "</td>";
							newRow += "<td>" + GetMyDataTypeText(data.Sys_MapAttr[i].MyDataType) + "</td>";
							newRow += "<td>min=" + data.Sys_MapAttr[i].MinLen + ",max=" + data.Sys_MapAttr[i].MaxLen + "</td>";
							newRow += "<td>" + data.Sys_MapAttr[i].UIRefKey + "</td>";

							//newRow += "<td>" + data.Sys_MapAttr[i].Email + "</td>";
							//newRow += "<td>" + data.Sys_MapAttr[i].Addr + "</td>";

							//普通类型的字段.
							//WF/Admin/FoolFormDesigner/EditF.htm?MyPK=WoDeZiADun_WoDeZiDuan&FK_MapData=WoDeZiADun&KeyOfEn=WoDeZiDuan

							//枚举类型
							//WF/Admin/FoolFormDesigner/EditEnum.htm?DoType=Edit&FK_MapData=WoDeZiADun&MyPK=WoDeZiADun_FaWenLeiXing&EnumKey=FaWenLeiXing&s=0.6022623278189881

							//外键.http://localhost:26507/WF/Admin/FoolFormDesigner/EditTableField.htm?DoType=Edit&FK_MapData=WoDeZiADun&FK_MapDtl=WoDeZiADun&MyPK=WoDeZiADun_CN_PQ&FK_SFTable=CN_PQ

							/*
							newRow += "<td>";
							newRow += "<a href=\"javascript:Edit('" + data[i].No + "')\"><img src='/WF/Img/Btn/Edit.gif' border=0 />编辑</a>";
							newRow += "<a href=\"javascript:Delete('" +
								data[i].MyPK +
								"')\"><img src='/WF/Img/Btn/Delete.gif' border=0 />删除</a>";
							newRow += "</td>";
							*/

							newRow += "</tr>";
							switch(data.Sys_MapAttr[i].LGType) {
								case 0: //普通
									normalFieldRows += newRow;
									break;
								case 1: //枚举
									enumFieldRows += newRow;
									break;
								case 2: //外键
									fkFieldRows += newRow;
									break;
								default:
									break;
							}
						}
						$("#Table1 tr:last").after("<tr><td colspan='9'>普通字段</td></tr>");
						$("#Table1 tr:last").after(normalFieldRows);
						$("#Table1 tr:last").after("<tr><td colspan='9'>枚举字段</td></tr>");
						$("#Table1 tr:last").after(enumFieldRows);
						$("#Table1 tr:last").after("<tr><td colspan='9'>外键字段</td></tr>");
						$("#Table1 tr:last").after(fkFieldRows);
						/*for (var i in data.Sys_GroupField) {
							newRow = "";
							//<th>序号</th>
							//<th>字段名</th>
							//<th>中文名</th>
							//<th>类型</th>
							//<th>长度</th>
							//<th>关联</th>
							//<th>编辑</th>
							newRow = "<tr ><td class=Idx>" + i + "</td>";
							//newRow += "<td>" + data.Sys_MapAttr[i].MyPK + "</td>";
							newRow += "<td>" + data.Sys_MapAttr[i].KeyOfEn + "</td>";
							newRow += "<td>" + data.Sys_MapAttr[i].Name + "</td>";
							newRow += "<td>" + GetMyDataTypeText(data.Sys_MapAttr[i].MyDataType) + "</td>";
							newRow += "<td>min=" + data.Sys_MapAttr[i].MinLen + ",max=" + data.Sys_MapAttr[i].MaxLen + "</td><td>关联</td>";
							//newRow += "<td>" + data.Sys_MapAttr[i].Email + "</td>";
							//newRow += "<td>" + data.Sys_MapAttr[i].Addr + "</td>";
							newRow += "</tr>";
							$("#Table1 tr:last").after(newRow);
						}*/
					}
				}
			});
		}

		function GetMyDataTypeText(key) {
			switch (key) {
				case 1:
					return "string";
				case 2:
					return "int";
				case 3:
					return "float";
				case 4:
					return "boolean";
				case 5:
					return "double";
				case 6:
					return "date";
				case 7:
					return "datetime";
				case 8:
					return "money";
				default:
					return "unknow";
			}
		}

		function Delete(no) {

			if (window.confirm('您确定要删除吗？') == false)
				return;

			//删除学生.
			$.ajax({
				type: 'post',
				async: true,
				url: Handler + "?DoType=FiledsList_Delete&No=" + no + "&m=" + Math.random(),
				dataType: 'html',
				success: function (data) {

					$("#Msg").html(data);

					if (data.indexOf('err@') == 0) {
						alert(data);
						return;

					} else {

						alert(data);

						window.location.href = window.location.href;
					}
				}
			});
		}

		function Edit(no) {
			var url = 'Fileds.htm?No=' + no;
			var b = window.showModalDialog(url, 'ass', 'dialogHeight: 400px; dialogWidth: 500px;center: yes; help: no');
			window.location.href = window.location.href;
		}
	 </script>
</head>
<body onkeypress="Esc()" >

<table id="Table1">
<caption>字段列表  - <a href="javascript:WinOpen('/WF/Admin/FoolFormDesigner/FieldTypeList.htm?FK_MapData=WoDeZiADun')">新增</a></caption>
	<tr>
		<th>序号</th>
		<th>字段名</th>
		<th>中文名</th>
		<th>类型</th>
		<th>长度</th>
		<th>关联</th>
		<th>编辑</th>
	</tr>
</table>

<div id="Msg"></div>

</body>
</html>
