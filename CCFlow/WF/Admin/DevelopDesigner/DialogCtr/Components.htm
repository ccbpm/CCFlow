<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>新建字段向导</title>
    <link rel="stylesheet" type="text/css" href="../../../Scripts/easyUI/themes/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../../../Scripts/easyUI/themes/icon.css" />
    <link href="../../../Comm/Style/Table0.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="../../../Scripts/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../../../Scripts/jquery/jquery.easyui.min.js"></script>
    <script language="JavaScript" src="../../../Comm/JScript.js" type="text/javascript"></script>
    <script type="text/javascript" src="../../../Scripts/bootstrap/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../../Scripts/bootstrap/js/bootstrap.min.js"></script>
    <script src="../../../Scripts/QueryString.js" type="text/javascript"></script>
    <script src="../../../Scripts/config.js" type="text/javascript"></script>
    <script src="../../../Scripts/PinYin.js" type="text/javascript"></script>
    <script src="../../../Comm/Gener.js" type="text/javascript"></script>
    <script src="../../FoolFormDesigner/Components/DDLBar.js"></script>
    <script src="../../FoolFormDesigner/Components/FrmComponentsEnum.js"></script>
    <script src="../js/ueditor/dialogs/internal.js"></script>
    <script src="../../Admin.js"></script>


    <style>
        body {
            font-family: Microsoft YaHei;
        }

        input:first-line {
            font-weight: bolder;
        }
    </style>
    <script language="javascript" type="text/javascript">


        var fk_mapdata = GetQueryString("FK_MapData");
        var groupID = GetQueryString("GroupField");
        if (groupID == null)
            groupID = 1;

        //页面启动函数.
        $(function () {

            InitBar(0,8);

        });

        var oNode = null, thePlugins = 'component';
        dialog.oncancel = function () {
            if (UE.plugins[thePlugins].editdom) {
                delete UE.plugins[thePlugins].editdom;
            }
        };

        dialog.onok = function () {
            //保存控件
            var frmComponent = $("#changBar").val();
            switch (parseInt(frmComponent)) {
                case 4: //地图控件
                    ExtMap();
                    break;
                case 5://录音控件
                    break;
                case 6: //字段附件
                    break;
                case 7:
                    break;
                case 8://签字版 
                    break;
                case 9://超链接
                    break;
                case 10://文本
                    break;
                case 11://图片
                    break;
                case 12://图片附件
                    break;
                case 13://身份证
                    break;
                case 14://签批组件
                    break;
                case 15://评论组件
                    break;
                case 16://系统定位
                    break;
                case 17:// 公文字号
                    ExtDocWord();
                    break;
                case 18:
                    break;
                case 50://流程进度图
                    break;
                case 60://大文本
                    break;
                case 70://独立附件
                    break;
                case 80://从表
                    break;
                case 101://评分控件
                    break;

            }
        }

        //地图
        function ExtMap() {
            var name = window.prompt('请输入地图名称:\t\n比如:中国地图', '地图');
            if (name == null || name == undefined)
                return;

            var frmID = fk_mapdata;
            var mapAttrs = new Entities("BP.Sys.MapAttrs");
            mapAttrs.Retrieve("FK_MapData", frmID, "Name", name);
            if (mapAttrs.length >= 1) {
                alert('名称：[' + name + "]已经存在.");
                ExtMap();
                return;
            }

            //获得ID.
            var id = StrToPinYin(name);
            var mypk = frmID + "_" + id;
            var mapAttr = new Entity("BP.Sys.MapAttr");
            mapAttr.MyPK = mypk;
            if (mapAttr.IsExits == true) {
                alert('名称：[' + name + "]已经存在.");
                ExtMap();
                return;
            }

            var mypk = frmID + "_" + id;
            var mapAttr = new Entity("BP.Sys.MapAttr");
            mapAttr.UIContralType = 4; //地图.
            mapAttr.MyPK = mypk;
            mapAttr.FK_MapData = frmID;
            mapAttr.KeyOfEn = id;
            mapAttr.Name = name;
            mapAttr.MyDataType = 1;
            mapAttr.LGType = 0;
            mapAttr.ColSpan = 1; // 
            mapAttr.UIWidth = 800;//宽度
            mapAttr.UIHeight = 500;//高度
            mapAttr.Insert(); //插入字段.

            var mapAttr1 = new Entity("BP.Sys.MapAttr");
            mapAttr.UIContralType = 0;
            mapAttr1.MyPK = frmID + "_AtPara";
            mapAttr1.FK_MapData = frmID;
            mapAttr1.KeyOfEn = "AtPara";
            mapAttr1.UIVisible = 0;
            mapAttr1.Name = "AtPara";
            mapAttr1.MyDataType = 1;
            mapAttr1.LGType = 0;
            mapAttr1.ColSpan = 1; // 
            mapAttr1.UIWidth = 100;
            mapAttr1.UIHeight = 23;
            mapAttr1.Insert(); //插入字段

            mapAttr.Retrieve();
            //var url = './../../Comm/EnOnly.htm?EnName=BP.Sys.FrmUI.ExtMap&MyPK=' + mapAttr.MyPK;
            var _html = "<div style='text-align:left;padding-left:0px' id='Map_" + mapAttr.KeyOfEn + "' data-type='Map' data-key='" + mapAttr.MyPK + "' leipiplugins='component'>";
            _html += "<input type='button' name='select' value='选择'  style='background: #fff;color: #545454;font - size: 12px;padding: 4px 15px;margin: 5px 3px 5px 3px;border - radius: 3px;border: 1px solid #d2cdcd;'/>";
            _html += "<input type = text style='width:200px' maxlength=" + mapAttr.MaxLen + "  id='TB_" + mapAttr.KeyOfEn + "' name='TB_" + mapAttr.KeyOfEn + "' />";
            _html += "</div>";
            editor.execCommand('insertHtml', _html);
           
        }

        //公文字号
        function ExtDocWord() {
            var en = new Entity("BP.Sys.MapAttr");
            en.SetPKVal(fk_mapdata + "_DocWord");
            if (en.RetrieveFromDBSources() == 1) {
                alert("该表单DocWord字段已经存在，公文字号默认的字段DocWord,请确认该字段是否为公文字段");
                return;
            }


            var mypk = fk_mapdata + "_DocWord";
            var mapAttr = new Entity("BP.Sys.MapAttr");
            mapAttr.UIContralType = 17; //公文字号.
            mapAttr.MyPK = mypk;
            mapAttr.FK_MapData = fk_mapdata;
            mapAttr.KeyOfEn = "DocWord";
            mapAttr.Name = "公文字号";
            mapAttr.MyDataType = 1;
            mapAttr.LGType = 0;
            mapAttr.ColSpan = 1; // 
            mapAttr.UIWidth = 150;
            mapAttr.UIHeight = 170;
            mapAttr.Insert(); //插入字段.
            mapAttr.Retrieve();
            var _Html = "<input type='text'  id='TB_DocWord' name='TB_DocWord' data-key='DocWord' data-name='公文字号' data-type='DocWord'   leipiplugins='component' style='width:98%'/>";
            editor.execCommand('insertHtml', _Html);
        }
        
    </script>

</head>
<body>
    <div id="bar"></div>
</body>
</html>
