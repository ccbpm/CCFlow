<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>字段</title>
    <!--引入jquery-->
    <script src="../../Scripts/jquery-1.11.0.min.js"></script>
    <!--引入bootstrap-->
    <link href="../../Scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <script src="../../Scripts/bootstrap/js/bootstrap.min.js"></script>

    <!--引入easyui-->
    <script src="../../Scripts/easyUI145/jquery.easyui.min.js"></script>
    <script src="../../Scripts/EasyUIUtility.js"></script>
    <link href="../../Scripts/easyUI145/themes/default/easyui.css" rel="stylesheet" />
    <link href="../../Scripts/easyUI145/themes/icon.css" rel="stylesheet" />

    <!--引入通用的JS-->
    <script src="../../Scripts/QueryString.js"></script>
    <script src="../../Scripts/config.js"></script>
    <script src="../../Comm/Gener.js"></script>
    <script src="../../Scripts/PinYin.js"></script>
    <script src="../../Scripts/vue.js"></script>
    <link href="../../../DataUser/Style/ccbpm.css" rel="stylesheet" />

</head>
<body>

    <table id="App" style="width:100%">
        <tr>
            <th>序</th>
            <th>字段</th>
            <th>英文名</th>
            <th>类型</th>
            <th>操作</th>
        </tr>

        <tr v-for="(value,index) in delData">
            <td>{{index+1}}</td>
            <td>{{value.KeyOfEn}}</td>
            <td>{{value.Name}}</td>
            <td>{{value.contralType}}</td>
            <td> <a href="#" @click="Edit(value.MyPK);">编辑</a></td>
        </tr>

    </table>

    <script type="text/javascript">


        var Baseinfo = new Vue({
            el: '#App',
            data: {
                //listData: [],
                delData: []
            },
            created() {
                var frmID = GetQueryString("FrmID");
                var ens = new Entities("BP.Sys.MapAttrs");
                ens.Retrieve("FK_MapData", frmID, "Idx");
                //this.listData = ens.GetEns();

                var handler = new HttpHandler("BP.WF.HttpHandler.WF_Admin_DevelopDesigner");
                handler.AddPara("FrmID", frmID);
                var html = handler.DoMethodReturnString("Fields_Init");

                //data-key="Age"
                var list = ens.GetEns();
                var deldate = [];
                list.data.map(function (item, index) {
                    if (item.KeyOfEn &&  html.indexOf('data-key="' + item.KeyOfEn + '"') == -1 && index>7) {
                        item.contralType = GetFieldType(item);
                        deldate.push(item);
                    }
                });
                this.delData = deldate;
               
            },
            methods: {
                Edit: function (myPK) {
                    var url = "/WF/Comm/En.htm?EnName=BP.Sys.MapAttr&MyPK=" + myPK;
                    WinOpen(url);
                },
                Insert: function () {
                    var workid = GetQueryString("WorkID");
                    var url = "/WF/Comm/En.htm?EnName=BP.TGK.ND14Rpt&OID=" + workid;
                    WinOpen(url);
                }
            }
        })

        function GetFieldType(mapAttr) {

            if (mapAttr.UIContralType == 0) {
                //控件数据类型
                if (mapAttr.MyDataType == "1") {
                    return "文本框 String";
                } else if (mapAttr.MyDataType == "2") {
                    return "文本框 Int";
                } else if (mapAttr.MyDataType == "3") {
                    return "文本框 Float";
                } else if (mapAttr.MyDataType == "4") {
                    return "文本框 Boolean";
                } else if (mapAttr.MyDataType == "5") {
                    return "文本框 Double";
                } else if (mapAttr.MyDataType == "6") {
                    return "文本框 Date";
                } else if (mapAttr.MyDataType == "7") {
                    return "文本框 DateTime";
                } else if (mapAttr.MyDataType == "8") {
                    return "文本框 Money";
                }
            } else if (mapAttr.UIContralType == 1) {
                //枚举下拉框
                if (mapAttr.LGType == 1) {
                    return "枚举下拉框";
                } //外键下拉框
                else if (mapAttr.LGType == 2) {
                    return "外键下拉框";
                }
                //外部数据源
                else if (mapAttr.LGType == 0) {
                    return "外部数据源";
                }
            } else if (mapAttr.UIContralType == 2) {//复选框
                return "复选框";
            } else if (mapAttr.UIContralType == 3) {//单选框
                return  "";
            } 
            return "其他类型";
        }

    </script>


</body>
</html>