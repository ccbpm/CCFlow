<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!--<link  href="./../Style/Table0.css" rel="stylesheet" type="text/css" />-->

    <link href="/WF/Scripts/easyUI15/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    
    <style type="text/css">
        .style1
        {
            width: 105px;
        }
        #Text4
        {
            width: 447px;
        }
        #TB_Addr
        {
            width: 450px;
        }

        .panel-body-noborder {
        text-align:center;
        }

        #ulNodeFrmImp {
            list-style: none;
            padding: 0px;
        }

        #ulNodeFrmImp li{
        width:100%;
        padding:0px;
        }
    </style>
    <!--<link rel="stylesheet" href="https://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css" />
    <script src="https://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>-->
    <!--<link href="/WF/Scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />-->

    <title>表单导入</title>

    <script language="JavaScript" src="/WF/Comm/JScript.js" type="text/javascript" ></script>
    <script type="text/javascript" src="/WF/Scripts/bootstrap/js/jquery.min.js"></script>
    <!--<script type="text/javascript" src="/WF/Scripts/bootstrap/js/bootstrap.min.js"></script>-->
    <script src="../../../Scripts/easyUI15/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../../../Scripts/QueryString.js" type="text/javascript"></script>
    <link href="../../../../DataUser/Style/table0.css" rel="stylesheet"  type="text/css" />
   


    <!-- 引用通用的js文件. -->
    <script type="text/javascript" src="../../../Comm/Gener.js"></script>
    <script type="text/javascript" src="../../../Scripts/config.js"></script>
    <script type="text/javascript" language="javascript" >
        console.log(window.parent)
        //页面启动函数.
        var frmID = GetQueryString("FK_MapData");
        var fk_flow = GetQueryString("FK_Flow");
        var fk_node = GetQueryString("FK_Node");
        $(function () {
            if (fk_node == null) {//如果当前不是节点表单 就隐藏节点表单导入
                //$('#divUlNodeFrmImp').hide();
            }
            $("#Msg").html("<img src=../../../Img/loading.gif />&nbsp;正在加载,请稍后......");

            
            var flowNo = frmID.substr(2, frmID.length - 4);
            if (flowNo > 10 && flowNo < 100) {
                flowNo = '0'+flowNo;
            } else if (flowNo < 10) {
                flowNo = '00'+flowNo;
            }

            /*
            *  首先要把初始化控件的代码写入到这里,不然会导致界面的批量赋值失败.
            */

            $.ajax({
                type: 'post',
                async: true,
                url: Handler + "?DoType=Imp_Init&FK_MapData=" + frmID + "&FK_Flow=" + flowNo + "&m=" + Math.random(),
                dataType: 'html',
                success: function (db) {

                    if (db.indexOf("err@") > -1) {
                        alert(db);
                        return;
                    }

                    db = JSON.parse(db);

                    //节点表单.
                    var WF_Node = db["WF_Node"];
                    var ulHtml = '';
                    for (var i = 0; i < WF_Node.length; i++) {
                        var node = WF_Node[i];
                        ulHtml += '<li><input id="nd' + node.NODEID + '" type="radio" name="node" class="btn btn-default" data-nodeid=' + node.NODEID + '><label for="nd' + node.NODEID + '">ID:' + node.NODEID + ' - ' + node.NAME + '<label/></li>'
                    }

                    $('#ulNodeFrmImp').html(ulHtml);
                }
            });


            //加载完成.
            $("#Msg").html("");
        });
    </script>

    <script>
        function addTab(title, url) {
            if ($('#tt').tabs('exists', title)) {
                $('#tt').tabs('select', title);
            } else {
                var content = '<iframe scrolling="auto" frameborder="0"  src="' + url + '" style="width:100%;height:100%;"></iframe>';
                $('#tt').tabs('add', {
                    title: title,
                    content: content,
                    closable: true
                });
            }
        }

        function saveCopyFromFrmNode() {
            var nodeId = $('#ulNodeFrmImp input:checked').data().nodeid;
            $.ajax({
                type: 'post',
                async: true,
                url: Handler + "?DoType=Imp_CopyFrm&FK_MapData=" + frmID + "&FromMapData=ND" + nodeId + "&" + $('#formCC').serialize() + "&m=" + Math.random(),
                dataType: 'html',
                success: function (data) {
                    alert(data)
                    if (responseStr.indexOf("执行成功") != -1) {
                        window.parent[0].Reload();
                    }
                }
            });
        }


        function saveImpFromLocalXML() {
            var formData = new FormData();
            var name = $("input").val();
            formData.append("file", $("#localXmlFile")[0].files[0]);
            formData.append("name", name);
            $.ajax({
                url: Handler + "?DoType=Imp_LoadFrmTempleteFromLocalFile&FK_MapData=" + frmID + "&m=" + Math.random(),
                type: 'POST',
                data: formData,
                // 告诉jQuery不要去处理发送的数据
                processData: false,
                // 告诉jQuery不要去设置Content-Type请求头
                contentType: false,
                beforeSend: function () {
                    
                },
                success: function (responseStr) {
                    alert(responseStr);
                    console.log(window.parent)
                    if (responseStr.indexOf("执行成功")!=-1) {
                        window.parent[0].Reload();
                    }
                    //if (responseStr.status === 0) {
                    //    console.log("成功" + responseStr);
                    //} else {
                    //    console.log("失败");
                    //}
                },
                error: function (responseStr) {
                    alert("error"+responseStr);
                }
            });
        }
    </script>
</head>
<body>
    <form id="formCC" method="post" enctype="multipart/form-data">
    <div id="Msg"> </div>
    <div id="tt" class="easyui-tabs" style="width:100%;height:500px;">
        <div title="从本机导入" style="padding:15px;">
            <div style="text-align:right;margin-right:50px;">
            </div>
            <div>

            <fieldset>
            <legend>选择表单模板文件(*.xml),然后按确定按钮 </legend>

                 <label style="padding-left:8px;"></label><br /><br />
                <input type="file" id="localXmlFile" name="localXmlFile" />
                 <input type="button" value="模板导入" onclick="saveImpFromLocalXML()" />
            </fieldset>

            </div>

            </div>
        <div title="从节点表单导入" id="divUlNodeFrmImp">
            <fieldset>
                <legend>请选择一个节点表单</legend>
                <!-- 节点表单列表 -->
                <ul id="ulNodeFrmImp"></ul>

                <hr />


                <input type="checkbox" checked="checked" id="ckClear" name="IsClear" />是否清除
                <input type="checkbox" checked="checked" id="ckReadOnly" name="IsSetReadonly" />是否只读
                <input type="button" value="从节点表单导入" onclick="saveCopyFromFrmNode()" id="copyFromFrmNodeSave" />
            </fieldset>

        </div>
        <div title="从表单库导入" style="padding:15px;">
            <input type="button" class="btn btn-default" value="进入templete.ccflow.org执行导入" /><br /><br />
            <label style="padding-left:8px;">ccflow为您提供丰富的表单共享模板，您可以轻松的创建您的BPM系统</label>
        </div>
        <div title="从外部数据源导入" style="padding:15px;">
            <label style="padding-left:8px;">操作提示：制定内外部数据源中的一个已经设计好的表，把字段信息导入该表单中</label><br /><br />
            <input type="button" class="btn btn-default" value="进入导入数据表字段向导" />
        </div>
    </div>
</form>
    <!--<ul id="myTab" class="nav nav-tabs">
        <li class="active">
            <a href="#localImp" data-toggle="tab">从本机导入</a>
        </li>
        <li><a href="#nodeFrmImp" data-toggle="tab">从节点表单导入</a></li>
        <li><a href="#frmClassImp" data-toggle="tab">从表单库导入</a></li>
        <li><a href="#outDataSourceImp" data-toggle="tab">从外部数据源导入</a></li>
    </ul>
    <div id="" class="tab-content">
        <!--从本机导入-->
        <!--<div class="tab-pane fade in active" id="localImp">
            <input type="button" class="btn btn-default" value="进入templete.ccflow.org执行导入" />
        </div>-->
        <!--从节点表单导入-->
        <!--<div class="tab-pane fade in" id="nodeFrmImp">
            选择表单模板文件(*.xml),然后按确定按钮
            <input type="file" />
        </div>-->
        <!--从表单库导入-->
        <!--<div class="tab-pane fade in" id="frmClassImp">
            <ul class="nav nav-pills nav-stacked">
                <li role="presentation"><a href="#">Step1 节点1</a></li>
                <li role="presentation" class="active"><a href="#">Step2 节点2</a></li>
                <li role="presentation"><a href="#">Step3 节点3</a></li>
            </ul>
        </div>-->
        <!--从外部数据源导入-->
        <!--<div class="tab-pane fade in" id="outDataSourceImp">
            <label>操作提示：制定内外部数据源中的一个已经设计好的表，把字段信息导入该表单中</label>
            <input type="button" class="btn btn-default"value="进入导入数据表字段向导"/>
        </div>
    </div>-->
</body>
</html>
 