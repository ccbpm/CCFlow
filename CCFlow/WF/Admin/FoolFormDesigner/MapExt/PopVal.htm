<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>弹窗工作模式设置</title>
    <script type="text/javascript" src="../../../Scripts/bootstrap/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../../Scripts/bootstrap/js/bootstrap.min.js"></script>
    <script src="../../../Scripts/QueryString.js" type="text/javascript"></script>
    <style type="text/css">
        #TBSQL
        {
            width: 1159px;
             height:200px;
        }
        #TB_Url
        {
            width: 789px;
        }
        #TB_ColNames
        {
            width: 383px;
        }
        #TB_RootVal
        {
            width: 52px;
        }
        #TB_Tree_SQL0
        {
            width: 299px;
        }
        #TB_Tree_SQL
        {
            height: 23px;
            width: 177px;
        }
        #TB_TablePage_SQL
        {
            width: 90%;
        }
        #TB_TablePage_SQLCount
        {
            width: 90%;
        }
    </style>
    <base target="_self" />
    <script type="text/javascript">
        function Esc() {
            if (event.keyCode == 27)
                window.close();
            return true;
        }
        function WinOpen(url, name) {
            window.open(url, name, 'height=600, width=800, top=0, left=0, toolbar=no, menubar=no, scrollbars=yes, resizable=yes, location=no, status=no');
        }
        function TROver(ctrl) {
            ctrl.style.backgroundColor = 'LightSteelBlue';
        }

        function TROut(ctrl) {
            ctrl.style.backgroundColor = 'white';
        }
        /*隐藏与显示.*/
        function ShowHidden(ctrlID) {

            var ctrl = document.getElementById(ctrlID);
            if (ctrl.style.display == "block") {
                ctrl.style.display = 'none';
            } else {
                ctrl.style.display = 'block';
            }
        }
        //执行保存
        function Save() {
            var fk_mapExt = GetQueryString("MyPK");
            var frmData = $("#cc").serialize();

           // alert(frmData);

            $.ajax({
                data:frmData,
                type: 'post',
                async: true,
                url: "MapExtHandler.ashx?DoType=PopVal_Save&FK_MapExt=" + fk_mapExt + "&m=" + Math.random(),
                dataType: 'html',
                success: function (data) {
                    alert(data);
                }
            });
        }

        function SaveAndClose() {
            Save();
            window.close();
        }

        function Close() {
            window.close();
        }

       //页面启动函数.
       $(function () {
           InitPage();

       });

       function TestData() {
         
            var fk_mapExt = GetQueryString("MyPK");
            var keyOfEn = GetQueryString("RefNo");
            var fk_mapData = GetQueryString("FK_MapData");

            $.ajax({
                type: 'post',
                async: true,
                url: "/WF/CCForm/CCFormHeader.ashx?DoType=InitPopVal&pageIndex=1&pageSize=12&ReqCount=0&MyPK=" + fk_mapExt + "&m=" + Math.random(),
                dataType: 'html',
                success: function (data) {
                    alert(data);
                }
            })
        }

        function GetJson() {

            alert('ss');
            var fk_mapExt = GetQueryString("MyPK");
            var keyOfEn = GetQueryString("RefNo");
            var fk_mapData = GetQueryString("FK_MapData");

            alert('ssss');


            $.ajax({
                type: 'post',
                async: true,
                url: "/WF/CCForm/CCFormHeader.ashx?DoType=InitPopSetting&MyPK=" + fk_mapExt + "&m=" + Math.random(),
                dataType: 'html',
                success: function (data) {
                    alert(data);
                }
            })
        }


        function InitPage() {

            var fk_mapExt = GetQueryString("MyPK");
            var keyOfEn = GetQueryString("RefNo");
            var fk_mapData = GetQueryString("FK_MapData");

            $.ajax({
                type: 'post',
                async: true,
                url: "MapExtHandler.ashx?DoType=PopVal_Init&MyPK=" + fk_mapExt + "&FK_MapData=" + fk_mapData + "&KeyOfEn=" + keyOfEn + "&m=" + Math.random(),
                dataType: 'html',
                success: function (data) {

                    data = data.replace("\t\n", "");
                    data = data.replace("\t\n", "");
                    data = data.replace("\t\n", "");
                    data = data.replace("\t\n", "");
                    data = data.replace("\t\n", "");
                    data = data.replace("\t\n", "");
                    data = data.replace("\t\n", "");

                    data = JSON.parse(data);

                    //设置选择的模式.
                    $("#RB_PopWorkModel_" + data.PopValWorkModel).attr("checked", "checked");

                    //alert($("#RB_PopWorkModel_" + data.PopValWorkModel).attr("checked"));

                    switch (data.PopValWorkModel) {
                        case "SelfUrl":
                            $("#TB_Url").val(data.URL);
                            break;
                        case "TableOnly": //仅仅表格.
                            $("#TB_Table_SQL").val(data.EntitySQL);
                            break;
                        case "TablePage":  //表格分页模式.
                            $("#TB_TablePage_SQL").val(data.PopValTablePageSQL);
                            $("#TB_TablePage_SQLCount").val(data.PopValTablePageSQLCount);
                            break;
                        case "Group":
                            break;
                        case "Tree":
                            break;
                        default:
                            alert('没有判断的元素.');
                            break;
                    }

                    //给公共属性赋值.
                    $("#TB_Width").val(data.W);
                    $("#TB_Height").val(data.H);
                    $("#TB_Title").val(data.Title);

                    //搜索提示.
                    $("#TB_PopValSearchTip").val(data.PopValSearchTip);

                    //替换列信息.
                    $("#TB_ColNames").val(data.PopValColNames);


                    //设置返回值模式.
                    $("#RB_PopValFormat_" + data.PopValFormat).attr('checked', 'checked');
                    // alert(data.PopValFormat);

                    //设置选择模式.
                    $("#RB_PopValSelectModel_" + data.PopValSelectModel).attr('checked', 'checked');
                }
            });
        }
     
    </script>
</head>
<body onkeypress="Esc();">
<form id="cc"   >
<!---------------------------- 模式1 ：自定义URL ---------------------------------------------------->
<fieldset>
<legend><input id="RB_PopWorkModel_SelfUrl" type="radio" name="Model" value="SelfUrl"  /><label for="RB_PopWorkModel_SelfUrl">自定义URL</label>  </legend>
<a href="javascript:ShowHidden('url')">自定义URL:</a>
 <div id="url" style="color:Gray; display:none">
 <ul>
 <li>您选择了使用外部的URL. </li>
 <li>使用外部的URL，我们提供了一个demo,您需要按照自己的格式来编写该url.</li>
 <li>该demo的位置 /SDKFlowDemo/SDKFlowDemo/PopSelectVal.aspx </li>
 <li>可以使用@SDKFromServHost 变量，标识一个配置路径，该配置在web.config里设置。</li>
 </ul>
 </div>
<input type="text" id="TB_Url" name="TB_Url" value=""   />
</fieldset>

<!---------------------------- 模式2：Table  ---------------------------------------------------->
<fieldset>
<legend><input id="RB_PopWorkModel_Table" type="radio" name="Model" value="TableOnly"  /><label for="RB_PopWorkModel_Table">表格模式</label>  </legend>
<a href="javascript:ShowHidden('Table')">初始化表格的查询 SQL </a>
 <div id="Table" style="color:Gray; display:none">
 
 <ul>
 <li>设置一个查询的SQL语句，必须返回No,Name两个列。</li>
 <li>比如:SELECT No,Name FROM Port_Emp </li>
 <li>该参数支持ccbpm表达式,比如:SELECT No, Name FROM Port_Emp WHERE FK_Dept='@WebUser.FK_Dept'</li>
 </ul>

 </div>
</fieldset>
<input type="text" id="TB_Table_SQL" name="TB_Table_SQL" value="" />



<!---------------------------- 模式3 ：分页的Table  ---------------------------------------------------->
<fieldset>


<legend><input id="RB_PopWorkModel_TablePage" type="radio" name="Model"  value="TablePage"  /><label for="RB_PopWorkModel_TablePage">表格分页模式</label>  </legend>
<a href="javascript:ShowHidden('TablePage')">数据展现SQL</a>
 <div id="TablePage" style="color:Gray; display:none">
 <ul>
 <li>设置一个查询的SQL语句，必须返回No,Name两个列。</li>
 <li>比如:SELECT No, Name FROM Port_Emp </li>
 <li>该参数支持ccbpm表达式,比如:SELECT No, Name FROM Port_Emp WHERE FK_Dept='@WebUser.FK_Dept'</li>
 <li>必须有：@PageCount @PageSize @Key 三个参数,分别标识:@PageCount =第几页, @PageSize=每页大小. @Key=关键字</li>
 <li>比如For SQLServer: SELECT TOP @PageSize * FROM
(
 SELECT  row_number() over(order by t.No) as rownumber,No,Name,Addr,Tel,Email FROM WF_Emp t
) A WHERE rownumber > @PageCount

<br />
总条数: SELECT COUNT(no) FROM WF_Emp WHERE Name LIKE '%@Key%'
 </li>
 <li>比如For Oracle: SELECT No,Name,Addr,Email,Tel FROM Port_Emp WHERE Name like '%@Key%'  </li>
 <li>比如For MySQL: SELECT No,Name,Addr,Email,Tel FROM Port_Emp WHERE Name like '%@Key%'  </li>
 </ul>
 </div>
 <br />


<input type="text" id="TB_TablePage_SQL" name="TB_TablePage_SQL" value="" />


 <br />

<a href="javascript:ShowHidden('TablePage_Count')">总条数</a>
 <br />

 <div id="TablePage_Count" style="color:Gray; display:none">
 <ul>
 <li>设置一个查询的SQL语句，必须返回No,Name两个列。</li>
 <li>比如:SELECT No, Name FROM Port_Emp </li>
 <li>该参数支持ccbpm表达式,比如:SELECT No, Name FROM Port_Emp WHERE FK_Dept='@WebUser.FK_Dept'</li>
 <li>必须有： @Key 参数. @Key=关键字</li>
 <li>比如For SQLServer: SELECT count(No) FROM Port_Emp WHERE Name like '%@Key%'  </li>
 <li>比如For Oracle: SELECT count(No) FROM Port_Emp WHERE Name like '%@Key%'  </li>
 <li>比如For MySQL: SELECT count(No) FROM Port_Emp WHERE Name like '%@Key%'  </li>
 </ul>
 </div>
<textarea  rows="3" id="TB_TablePage_SQLCount"  name="TB_TablePage_SQLCount" ></textarea>

<br />
<input type=button   onclick='TestData()' value='测试数据' />

 
</fieldset>

<!---------------------------- 模式4 ：分组显示,但是不分页.  ---------------------------------------------------->
<fieldset>
<legend><input id="RB_PopWorkModel_GroupModel" type="radio" name="Model" value="GroupModel"  /><label for="RB_PopWorkModel_GroupModel">分组模式</label>  </legend>
<a href="javascript:ShowHidden('GroupModel')">分组查询SQL</a>
 <div id="GroupModel" style="color:Gray; display:none">
 <ul>
 <li>设置一个查询的SQL语句，必须返回No,Name两个列。</li>
 <li>比如:SELECT No, Name FROM Port_Emp </li>
 <li>该参数支持ccbpm表达式,比如:SELECT No, Name FROM Port_Emp WHERE FK_Dept='@WebUser.FK_Dept'</li>
 <li>该方式不考虑分页，不关键字查询。</li>
 </ul>
 </div>
<input type="text" id="TB_GroupModel_Group"  name="TB_GroupModel_Group" value="" />

<a href="javascript:ShowHidden('TablePageEntity')">&nbsp;实体查询SQL</a>
 <div id="TablePageEntity" style="color:Gray; display:none">
 <ul>
 <li>设置一个查询的SQL语句，必须返回No,Name两个列。</li>
 <li>比如:SELECT No, Name FROM Port_Emp </li>
 <li>该参数支持ccbpm表达式,比如:SELECT No, Name FROM Port_Emp WHERE FK_Dept='@WebUser.FK_Dept'</li>
 <li>该方式不考虑分页，不关键字查询。</li>
 </ul>
 </div>
<input type="text" id="TB_GroupModel_Entity" name="TB_GroupModel_Entity" value="" />
</fieldset>


<!---------------------------- 模式5 ：树模式,没有关键字查询.  ---------------------------------------------------->
<fieldset>
<legend><input id="RB_PopWorkModel_Tree" type="radio" name="Model" value="TreeModel"  /><label for="RB_PopWorkModel_Tree">树模式</label>  </legend>
<a href="javascript:ShowHidden('Tree')">初始化树SQL</a>
 <div id="Tree" style="color:Gray; display:none">
 <ul>
 <li>设置一个查询的SQL语句，必须返回No,Name,Parent三个列。</li>
 <li>比如:SELECT No, Name,ParentNo FROM Port_Dept </li>
 <li>该参数支持ccbpm表达式,比如:SELECT No, Name,ParentNo FROM Port_Dept WHERE No='@WebUser.FK_Dept'</li>
 <li>返回的数据源里，必须有根节点。</li>
 </ul>
 </div>

<input type="text" id="TB_InitTree_SQL" name="TB_InitTree_SQL" value="" /> 根节点值:<input type="text" id="TB_RootVal" name="TB_RootVal"   value="" />
<br /> 
<a href="javascript:ShowHidden('TreeLJZ')">懒加载SQL:</a>

 <div id="TreeLJZ" style="color:Gray; display:none">
 <ul>
 <li>设置一个查询的SQL语句，必须返回No,Name,Parent三个列。</li>
 <li>格式:SELECT No, Name, ParentNo FROM Port_Dept WHERE ParentNo='@ParentNo' </li>
 </ul>
 </div>
    
    <input type="text" id="TB_LJZTree_SQL" name="TB_LJZTree_SQL"  value="" />
    </fieldset>

<!---------------------------- 高级设置.  ---------------------------------------------------->
<!--<fieldset>
<legend><label for="RB_PopWorkModel_Tree">高级设置</label>  </legend>-->
宽度(px)： <input type="text" id="TB_Width" name="TB_Width"  value="" />  
高度(px)：<input type="text" id="TB_Height" name="TB_Height"  value="" />   
开窗标题：<input type="text" id="TB_Title"  name="TB_Title"  value="" />
搜索关键字提示：<input type="text" id="TB_PopValSearchTip" name="TB_PopValSearchTip" value="" />
<br />

<a href="javascript:ShowHidden('ColName')">显示的中文列名(可以为空)：</a>
 <div id="ColName" style="color:Gray; display:none">
 <ul>
 <li>适用于表格方式数据显示，是为了避免在列表的表头上显示英文字段名对使用者不友好。</li>
 <li>可以为空，如果为空列名就按照英文名字显示。</li>
 <li>格式为: @col1=列名1@col2=列名2@col3=列名3 </li>
 </ul>
 </div>

<input type="text" id="TB_ColNames" name="TB_ColNames"  value="" />

<!--</fieldset>-->

<fieldset>
<legend> 返回值格式  </legend>
<input id="RB_PopValFormat_OnlyNo" type="radio" name="PopValFormat" value="OnlyNo"  /><label for="RB_PopValFormat_OnlyNo">No(仅编号)</label> 
<input id="RB_PopValFormat_OnlyName" type="radio" name="PopValFormat" value="OnlyName"  /><label for="RB_PopValFormat_OnlyName">Name(仅名称)</label> 
<input id="RB_PopValFormat_NoName" type="radio" name="PopValFormat" value="NoName"   /><label for="RB_PopValFormat_NoName">No,Name(编号与名称,比如zhangsan,张三;lisi,李四;)</label> 
</fieldset> 

<fieldset>
<legend> 选择模式  </legend>
<input id="RB_PopValSelectModel_One" type="radio" name="PopValSelectModel" value="One"  /><label for="RB_PopValSelectModel_One">单选</label> 
<input id="RB_PopValSelectModel_More" type="radio" name="PopValSelectModel" value="More"  /><label for="RB_PopValSelectModel_More">多选</label> 
</fieldset>

<input type="Button" value="获得Json"  onclick="GetJson()" />
<input type="Button" value="保存"  onclick="Save()" />
<input type="Button" value="保存并关闭"  onclick="SaveAndClose()" />
<input type="Button" value="关闭"  onclick="Close()" />


</form>


</body>
</html>
