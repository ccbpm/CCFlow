<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>创建本机数据表</title>
    <link href="../../../../DataUser/Style/ccbpm.css" rel="stylesheet" type="text/css" />
    <link href="../../../Scripts/easyUI/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <link href="../../../Scripts/easyUI/themes/icon.css" rel="stylesheet" type="text/css" />
    <script src="../../../Scripts/easyUI/jquery-1.8.0.min.js" type="text/javascript"></script>
    <script src="../../../Scripts/easyUI/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../../../Scripts/QueryString.js" type="text/javascript"></script>
    <script src="../../../Scripts/config.js" type="text/javascript"></script>
    <script src="../../../Comm/Gener.js" type="text/javascript"></script>
    <base target="_self" />
    <style type="text/css">
        .style1
        {
            width: 184px;
        }
        .style2
        {
            width: 284px;
        }
    </style>
    <script type="text/javascript" language="javascript">

        var CONST_STRUCTS = [{ No: '0', Name: '普通的编码表(具有No,Name)' }, { No: '1', Name: '树结构(具有No,Name,ParentNo)'}];

        /**
         * 数据格式切换
         */
        function loadStructSet(value, text) {
            if (value == CONST_STRUCTS[0].No) {
                $("#rootTr").hide();
            } else {
                $("#rootTr").show();
                // 根节点值
                $("#TB_RootValue").val("0");
            }
        }

        //页面启动函数.
        $(function () {

            $("#Msg").html("正在加载,请稍后......");

            // 初始化加载数据源
            $.ajax({
                type: 'post',
                async: true,
                url: Handler + "?DoType=SF5_Init&FK_MapData=" + GetQueryString("FK_MapData") + "&m=" + Math.random(),
                dataType: 'html',
                success: function (data) {

                    if (data.indexOf('err@') == 0) {
                        alert(data);
                        return;
                    }

                    data = JSON.parse(data);

                    //绑定数据源.
                    GenerBindDDL("DDL_FK_DBSrc", data, "No", "Name", "local");

                }
            });

            // 初始化加载数据格式
            GenerBindDDL("DDL_CodeStruct", CONST_STRUCTS, "No", "Name", CONST_STRUCTS[0].No);

            $("#Msg").html("");
        });

        // 保存
        function Save() {
            $("#Msg").html("正在加载,请稍后......");

            var no = $("#TB_No").val() || "";
            var name = $("#TB_Name").val() || "";
            if (no == "" || name == "") {
                alert('请输入编号名称.');
                return;
            }

            if ($("#DDL_CodeStruct").val() == CONST_STRUCTS[1].No) {

                var rootValue = $("#TB_RootValue").val() || "";
                if (rootValue == "") {
                    alert("根节点值必须填写！");
                    return;
                }
            }

            if (!$("#TB_SelectStatement").val() || $("#TB_SelectStatement").val().length == 0) {
                alert("SQL语句必须填写！");
                $("#TB_SelectStatement").focus();
                return;
            }

            var frmData = $("#cc").serialize();

            $.ajax({
                type: 'post',
                data: frmData,
                async: true,
                url: Handler + "?DoType=SF5_Save&m=" + Math.random(),
                dataType: 'html',
                success: function (data) {
                    if (data.indexOf('err@') == 0) {
                        alert(data);
                        return;
                    }
                    alert(data);
                    document.location.href = 'Default.htm?FK_MapData=' + GetQueryString("FK_MapData");;
                }
            });

            $("#Msg").html("");
        }
    </script>
</head>
<body>
    <form action="" id="cc">
        <table style="width: 95%; margin: 5px; padding: 5px;">
            <caption>
                <a href="./Default.htm">返回</a> - JQuery外键
            </caption>
            <tr>
                <th>项目</th>
                <th class="style2">值</th>
                <th>备注</th>
            </tr>
            <tr>
                <td class="GroupTitle">方法名</td>
                <td class="style2"><input type="text" id="TB_No" name="TB_No" /></td>
                <td>创建字典表的英文名称,不要以数字开头否则创建表出错.</td>
            </tr>
            <tr>
                <td class="GroupTitle">方法描述</td>
                <td class="style2"><input type="text" id="TB_Name" name="TB_Name" /></td>
                <td>创建字典表的中文名称</td>
            </tr>
        </table>
        <input type=button value="保存" />
    </form>
</body>
</html>
