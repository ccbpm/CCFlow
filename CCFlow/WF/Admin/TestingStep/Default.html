<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>测试容器</title>
    <link href="../../../DataUser/Style/ccbpm.css" rel="stylesheet" type="text/css" />
    <script src="../../Scripts/easyUI145/jquery.min.js" type="text/javascript"></script>
    <script src="../../Scripts/easyUI145/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../../Scripts/QueryString.js" type="text/javascript"></script>
    <script src="../../Scripts/config.js" type="text/javascript"></script>
    <script src="../../Comm/Gener.js" type="text/javascript"></script>
    <script language="javascript" type="text/javascript">

        //window.οnunlοad = onclose;
        //function onclose() {
        //    LetAdminerLogin();
        //}

        function onbeforeunload()
        {
            alert("关闭窗口");
            LetAdminerLogin();
        }

        //负责人：@qfl
        $(function () {

            //获得参数.
            var flowNo = ""; // this.GetQueryString("FK_Flow");
            if (flowNo == null || flowNo == undefined || flowNo == "")
                flowNo = "001";
            var flow = new Entity("BP.WF.Flow", flowNo);
            document.title = "测试容器:" + flow.Name;

            var adminer = GetQueryString("Adminer"); //管理员.
            var sid = GetQueryString("SID"); //管理员SID.
            var userNo = GetQueryString("UserNo"); //要登录的用户

            //访问后台，获得一个工作ID.
            var handler = new HttpHandler("BP.WF.HttpHandler.WF_Admin_TestingStep");
            handler.AddUrlData();
            var workid = handler.DoMethodReturnString("Default_Init");
            var urlEnd = "&FK_Flow=" + flowNo + "&WorkID=" + workid + "&UserNo=" + userNo + "&Adminer=" + adminer + "&SID=" + sid;

            document.getElementById("left").src = "Left.html?1=2" + urlEnd;
            document.getElementById("right").src = "../../MyFlow.htm?FK_Flow=" + flowNo + "&WorkID=" + workid;
        });


        //如果关闭的时候，就让admin登录.
        function LetAdminerLogin() {
            var adminer = GetQueryString("Adminer"); //管理员.
            var sid = GetQueryString("SID"); //管理员SID.

            //访问后台，获得一个工作ID.
            var handler = new HttpHandler("BP.WF.HttpHandler.WF_Admin_TestingStep");
            handler.AddUrlData();
            var data = handler.DoMethodReturnString("Default_LetAdminerLogin");
            alert(data);
        }
    </script>

</head>

<frameset cols="10%,90%">
    <frame name="left" id="left" src="Left.html" />
    <frame name="right" id="right" src="Welcome.html" />
</frameset>
</html>
