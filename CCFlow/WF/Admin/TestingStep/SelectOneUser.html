<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>切换用户</title>
    <link href="../../../DataUser/Style/ccbpm.css" rel="stylesheet" type="text/css" />
    <script src="../../Scripts/easyUI145/jquery.min.js" type="text/javascript"></script>
    <script src="../../Scripts/easyUI145/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../../Scripts/QueryString.js" type="text/javascript"></script>
    <script src="../../Scripts/config.js" type="text/javascript"></script>
    <script src="../../Comm/Gener.js" type="text/javascript"></script>
    <script language="javascript" type="text/javascript">

        var flowNo = GetQueryString("FK_Flow");
        var workid = GetQueryString("WorkID");
        var adminer = GetQueryString("Adminer");
        var adminerSID = GetQueryString("AdminerSID");

        //页面启动函数.
        $(function () {

            var webUser = new WebUser();
            $("#userInfo").html("<h3>" + webUser.No + "," + webUser.Name + "</h3>");

            var ens = new Entities("BP.WF.GenerWorkerLists");
            ens.Retrieve("WorkID", workid);

            var html = "<table>";
            
            html += "<tr>";
            html += "<th>Idx</th>";
            html += "<th>人员编号</th>";
            html += "<th>名称</th>";
            html += "<th>节点名称</th>";
            html += "<th>处理时间</th>";
            html += "<th>状态</th>";
            html += "<th>操作</th>";
            html += "</tr>";

            for (var i = 0; i < ens.length; i++) {
                var en = ens[i];

                html += "<tr>";
                html += "<td>Idx</td>";
                html += "<td>" + en.FK_Emp + "</td>";
                html += "<td>" + en.FK_EmpText + "</td>";
                html += "<td>" + en.FK_NodeText + "</td>";
                html += "<td>" + en.RDT + "</td>";
                if (en.IsPass == 0) {
                    html += "<td>待办</td>";
                    html += "<td><a href=\"javascript:ChangUser('" + en.FK_Emp + "')\">切换用户执行工作</a></td>";
                } else {
                    html += "<td>已处理</td>";
                    html += "<td> - </td>";
                }
                html += "</tr>";
            }
            html += "</table>";

            //绑定数据.
            $("#list").html(html);

        });

        function ChangUser(empNo) {

            //当这个人登录。
            var handler = new HttpHandler("BP.WF.HttpHandler.WF_Admin_TestingStep");
            handler.AddPara("FK_Emp", empNo);
            handler.AddPara("WorkID", workid);

            handler.AddPara("Adminer", adminer);
            handler.AddPara("AdminerSID", adminerSID);

            var data = handler.DoMethodReturnString("SelectOneUser_ChangUser");
            if (data.indexOf('err@') == 0) {
                alert(data);
                return;
            }
            window.open('../../MyFlow.htm?FK_Flow='+ flowNo + '&WorkID=' + workid,'_self');
            window.parent.refreshLeft();
        }

        // 选择接收人.
        function SelectOneUser() {
            alert(54);
            var url = "SelectOneUser.html";
            WinOpen(url, "right");
            //window.location.href = url;
        }
    </script>
</head>
<body>
    <fieldset>
        <legend> 当前登录人员</legend>
        <div id="userInfo"></div>
    </fieldset>

    <fieldset>
        <legend> 工作人员列表</legend>
        <div id="list"></div>
    </fieldset>

</body>
</html>