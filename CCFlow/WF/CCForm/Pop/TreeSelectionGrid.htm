<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title></title>
		<meta charset="UTF-8"/>
		<base target="_self" />
		<script language="JavaScript" src="../../Comm/JScript.js" type="text/javascript" ></script>
		<script type="text/javascript" src="../../Scripts/QueryString.js"></script>
		<script type="text/javascript" src="../../Scripts/config.js"></script>
		<link rel="stylesheet" type="text/css" href="../../Scripts/easyUI145/themes/default/easyui.css" />
		<link rel="stylesheet" type="text/css" href="../../Scripts/easyUI145/themes/icon.css" />
		<script type="text/javascript" src="../../Scripts/easyUI145/jquery.min.js"></script>
		<script type="text/javascript" src="../../Scripts/easyUI145/jquery.easyui.min.js"></script>
		<script type="text/javascript" src="../../Scripts/easyUI145/locale/easyui-lang-zh_CN.js"></script>
		<script type="text/javascript" src="../../Scripts/EasyUIUtility.js"></script>
		<script type="text/javascript">
			function loadSelectGrid(url, id) {
				url = url.replace("@Key", id);
				$.ajax({
					type: 'post',
					async: true,
					url: url + "&m=" + Math.random(),
					dataType: 'html',
					success: function (data) {
						if (data.indexOf("err@") != -1) {
							alert(data);
							return;
						}
						$("#selectGrid").datagrid("loadData", JSON.parse(data));
					}
				});
			}
			function findChildren(jsonArray, parentNo) {
				var appendToTree = function (treeToAppend, child) {
					$.each(treeToAppend, function (i, o) {
						if (o.id == child.ParentNo) {
							o.children.push({
								"id" : child.No,
								"text" : child.Name,
								"children" : []
							});
						} else {
							appendToTree(o.children, child);
						}
					});
				};
				var jsonTree = [];
				if ($.isArray(jsonArray) && typeof parentNo !== "undefined") {
					$.each(jsonArray, function (i, o) {
						if (o.ParentNo == parentNo) {
							jsonTree.push({
								"id" : o.No,
								"text" : o.Name,
								"children" : []
							});
						} else {
							appendToTree(jsonTree, o);
						}
					});
				}
				return jsonTree;
			}
			function loadTree(treeUrl, global) {
				$.ajax({
					type: 'post',
					async: true,
					url: treeUrl + "&m=" + Math.random(),
					dataType: 'html',
					success: function (data) {
						if (data.indexOf("err@") != -1) {
							alert(data);
							return;
						}
						var rootNo = GetQueryString("rootNo");
						var jsonTree = findChildren(JSON.parse(data), rootNo);
						$("#tree").tree("loadData", jsonTree);
					}
				});
			}
			$(function () {
				var treeClickUrl = GetQueryString("treeClickUrl");
				if (typeof treeClickUrl === "string") {
					treeClickUrl = unescape(treeClickUrl);
				}
				// tree
				$("#tree").tree({
					checkbox : false,
					onClick : function (node) {
						loadSelectGrid(treeClickUrl, node.id);
					}
				});
				var treeUrl = GetQueryString("treeUrl");
				if (treeUrl) {
					loadTree(unescape(treeUrl), window);
				}
				// grid1
				$("#selectGrid").datagrid({
					"onCheck" : function (rowIndex, rowData) {
						alert("onCheck\nrowIndex: " + rowIndex + "\nrowData: " + JSON.stringify(rowData));
					},
					"onUncheck" : function (rowIndex, rowData) {
						alert("onUncheck\nrowIndex: " + rowIndex + "\nrowData: " + JSON.stringify(rowData));
					},
					"onCheckAll" : function (rows) {
						alert("onCheckAll: " + JSON.stringify(rows));
					},
					"onUncheckAll" : function (rows) {
						alert("onUncheckAll: " + JSON.stringify(rows));
					}
				});
				
			});
		</script>
	<head>
	<body class="easyui-layout">
		<div data-options="region:'north'" style="height:100px;">
			
		</div>
		<div class="easyui-layout" data-options="region:'center'" border="false">
			<div data-options="region:'west',title:'权限部门档案'" style="width:250px;">
				<ul id="tree" class="easyui-tree"></ul>
			</div>
			<div class="easyui-layout" data-options="region:'center'" border="false">
				<div data-options="region:'north'" border="false" style="height:50%;">
					<table id="selectGrid" class="easyui-datagrid" data-options="fit:true,fitColumns:true,singleSelect:false,rownumbers:false">
						<thead>
							<tr>
								<th data-options="field:'Checked',checkbox:true"></th>
								<th data-options="field:'No',width:80">员工号</th>
								<th data-options="field:'Name',width:150">姓名</th>
							</tr>
						</thead>
					</table>
				</div>
				<div data-options="region:'center'" border="false">
					<table id="searchGrid" class="easyui-datagrid" data-options="fit:true,fitColumns:true,singleSelect:true,rownumbers:false">
						<thead>
							<tr>
								<th data-options="field:'No',width:80">员工号</th>
								<th data-options="field:'Name',width:150">姓名</th>
							</tr>
						</thead>
					</table>
				</div>
			</div>
		</div>
	</body>
</html>