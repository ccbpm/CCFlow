<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>数据导入</title>
    <link href="../../Scripts/easyUI/themes/icon.css" rel="stylesheet" type="text/css" />
    <link href="../../Scripts/easyUI/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <script src="../../Scripts/easyUI/jquery-1.8.0.min.js" type="text/javascript"></script>
    <script src="../../Scripts/easyUI/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../../Scripts/EasyUIUtility.js" type="text/javascript"></script>
    <link href="../../Scripts/SyntaxHighlighter/Styles/shCoreDefault.css" rel="stylesheet" type="text/css" />
    <script src="../../Scripts/SyntaxHighlighter/shCore.js" type="text/javascript"></script>
    <script src="../../Scripts/SyntaxHighlighter/shBrushCSharp.js" type="text/javascript"></script>
    <script src="../../Scripts/QueryString.js" type="text/javascript"></script>
       <link href="../../../DataUser/Style/ccbpm.css" rel="stylesheet" type="text/css" />

    <script src="../../Comm/JScript.js" type="text/javascript"></script>
    <script type="text/javascript" src="../../Scripts/config.js"></script>
    <script type="text/javascript" src="../../Comm/Gener.js"></script>
    <script type="text/javascript">
        var ensName;
        $(function () {
            ensName = GetQueryString("EnsName");
            var mapData = new Entity("BP.Sys.MapData", ensName);
            if (mapData != null) {
                $("#title").html(mapData.Name+"信息导入");
            }

        });

        //数据导入.
        function Imp_Done() {          
            var impWay = GetRadioValue("RB_ImpType");
            var fileValue = $("#File_Upload").val();
            //必须要选择文件
            if (fileValue == "") {
                $.messager.alert("提示", "没有选择要导入信息的Execl表。");
                return;
            }
            //扩展名
            var index = fileValue.lastIndexOf('.');
            var fileExt = fileValue.substring(index);
            if (fileExt.toLowerCase() != ".xls" && fileExt.toLowerCase() != ".xlsx") {
                $.messager.alert("提示", "所选不是excel文件，请重新选择。");
                return;
            }

            //URL 路径
            var URL = Handler + "?DoType=javaScriptImp_Done";

          
            //提交数据
            $("#cc").form("submit", {
                type: 'POST',
                dataType: 'html',
                url: Handler + "?DoType=ImpData_Done&ImpWay=" + impWay+"&EnsName="+ensName,
                onSubmit: function (param) {
                    //return false; //这里可以做表单的验证，如果验证失败，就return false 来终止表单提交  
                },
                success: function (data) {

                    if (data.indexOf('err@') == 0) {
                        alert(data);
                        return;
                    }

                    var json = eval('(' + data + ')');

                    $.messager.alert("提示", json.Msg, "icon-info", function () {
                       
                        //关闭导入界面
                        if (typeof window.parent.TabCloseByTitle != "undefined") {
                            //需要延时关闭，不可立即关闭。
                            setTimeout("window.parent.TabCloseByTitle('导入流程模版')", 1000);
                        }
                    });
                }
            });
        }

        function downloadFile() {
            var ensName = GetQueryString("EnsName");
            var downloadUrl = "../../../DataUser/TempleteOfImp/" + ensName + ".xls";
            var a = document.getElementById("downFileID");
            a.href = downloadUrl;
            a.download = "11.txt";
            a.click();
        }


    </script>
</head>
<body>
<form id="cc" name="cc" action="" enctype="multipart/form-data" method="post">
<table style=" width:100%">
<caption id="title">设备信息导入 </caption>
<tr>
<td  valign="top">
<fieldset>
<legend> 从本机导入  </legend>
<ul>
<li>从本机导入：请您选择本机的一个Excel文件 点击导入按钮完成导入。</li>
<li> 请选择文件:  <input type="file" id="File_Upload" name="File_Upload"  /></li>

<li>导入的方式: 
<ul>
<li><input id="Import_0" type="radio" name="RB_ImpType" value="0"  checked="true" /><label for="Import_0">清空方式导入.</label></li>
<li><input id="Import_1" type="radio" name="RB_ImpType" value="1"  /><label for="Import_1">更新方式导入.</label></li>
<li><input id="Import_2" type="radio" name="RB_ImpType" value="2"  /><label for="Import_2">追加方式导入.</label></li>
</ul>

<br />
 </li>
</ul>
<div style=" text-align:center; padding:5px;">
<input type=button id="Button1"  value="执行导入" onclick="Imp_Done();" />
 </div>
</fieldset>
<fieldset>
<legend>说明</legend>
<a href="#"onclick="downloadFile()">
    <img style="width: 16px; height: 16px;" src="../../../WF/Img/redo.png" border="0"/>
    下载导入模板
 </a>
 <br />
该模版存在:D:\ccflow\CCFlow\DataUser\TempleteOfImp\下面.
比如: :D:\ccflow\CCFlow\DataUser\TempleteOfImp\BP.Demo.BPFramework.Students.xls
</fieldset>

 </td>
</tr>
</table>
<a id="downFileID" href="#" style="display:none"></a>
</form>
</body>
</html>
