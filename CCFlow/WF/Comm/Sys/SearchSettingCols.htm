<html >
<head>
    <title>显示列设置</title>
    <script type="text/javascript" src="../../Scripts/bootstrap/js/jquery.min.js"></script>
    <script src="../../Scripts/QueryString2016.js" type="text/javascript"></script>
    <script type="text/javascript" src="../../Scripts/config.js"  ></script>
    <script src="../Gener.js?va2=2" type="text/javascript"></script>
    <link href="../../../DataUser/Style/ccbpm.css" rel="Stylesheet" />
    <script type="text/javascript">

        //页面启动函数.
        $(function () {

            var ensName = GetQueryString("EnsName");

            //全局配置.
            var en = new Entity("BP.Sys.EnCfg");
            en.No = ensName;
            en.Retrieve();

            //获得该实体的列.
            //var handler = new HttpHandler("BP.WF.HttpHandler.WF_Comm");

            var mapAttrs = new Entities("BP.Sys.MapAttrs");
            mapAttrs.Retrieve("FK_MapData", ensName, "Idx");
            if (mapAttrs.length == 0)
                alert("请启动傻瓜表单设计器");

            for (var i = 0; i < mapAttrs.length; i++) {

                var mapAttr = mapAttrs[i];
                if (mapAttr.KeyOfEn == 'OID') {
                    continue;
                }
                var mapAttrEn = new Entity("BP.Sys.MapAttr", mapAttr);

                var html = "";
                html += "<tr>";
                html += "<td>" + i + "</td>";
                html += "<td>" + mapAttr.KeyOfEn + "</td>";
                html += "<td>" + mapAttr.Name + "</td>";

                if (mapAttrEn.GetPara("SearchVisable") == "1")
                    html += "<td><a  href=\"javascript:HiddenIt('" + mapAttr.MyPK + "')\">隐藏</a></td>";
                else
                    html += "<td><a href=\"javascript:ShowIt('" + mapAttr.MyPK + "')\">显示</a></td>";


                html += "<td><a href=\"javascript:Up('" + mapAttr.MyPK + "')\">上移</a> - <a href=\"javascript:Down('" + mapAttr.MyPK + "')\">下移</a></td>";
                html += "</tr>";

                $("#Table1 tr:last").after(html);
            }

        });

        function HiddenIt(mypk, i) {
            var mapAttrEn = new Entity("BP.Sys.MapAttr", mypk);
            mapAttrEn.SetPara("SearchVisable", 0);
            mapAttrEn.Update();


            window.location.href = window.location.href;
        }

        function ShowIt(mypk) {
            var mapAttrEn = new Entity("BP.Sys.MapAttr", mypk);
            mapAttrEn.SetPara("SearchVisable", 1);
            mapAttrEn.Update();
            window.location.href = window.location.href;
        }

        function Up(mypk) {
            var mapAttrEn = new Entity("BP.Sys.MapAttr", mypk);
            mapAttrEn.DoMethodReturnString("DoUpTabIdx");
            window.location.href = window.location.href;
        }
        function Down(mypk) {
            var mapAttrEn = new Entity("BP.Sys.MapAttr", mypk);
            mapAttrEn.DoMethodReturnString("DoDownTabIdx");

            window.location.href = window.location.href;
        }


        function Save() {

            var ensName = GetQueryString("EnsName");

            //全局配置.
            var en = new Entity("BP.Sys.EnCfg", ensName);
            en.CopyForm(); //从from里面copy数据.
            en.No = ensName;
            en.Update();

            window.location.href = window.location.href;
        }

        function Back() {
            var url = "SearchSetting.htm?EnsName=" + GetQueryString("EnsName");
            window.location.href = url;
        }

        function Clear() {

            if (confirm('您确定要重置吗？重置后傻瓜表单设计内容，与排序内容都将会被清除。') == false)
                return;

            var mapdata = new Entity("BP.Sys.MapData", GetQueryString("EnsName"));
            mapdata.Delete();
            var mapAttrs = new Entities("BP.Sys.MapAttrs", "FK_MapData", GetQueryString("EnsName"));
            for (var i = 0; i < mapAttrs.length; i++) {
                mapAttrs[i].Delete();
            }
            //重置排序顺序


            window.location.href = window.location.href;
        }

        function FoolDesinger() {
            var url = "../../Admin/FoolFormDesigner/Designer.htm?FK_MapData=" + GetQueryString("EnsName") + "&FK_Flow=&FK_Node=0&IsFirst=1";
            window.open(url);
        }

        
    </script>
</head>
<body>
<table id="Table1" style="width:96%;">
<caption>设置显示的列</caption>
<tr>
<th >配置项</th>
<th>内容</th>
<th>信息</th>
<th>设置显示/隐藏</th>
<th>顺序</th>
</tr>

</table>
<input type="button" value="清空排序"  onclick="Clear()" />
<input type="button" value="启动傻瓜表单设计器"  onclick="FoolDesinger()" />
<input type="button" value="返回基本设置"  onclick="Back()" />


</body>
</html>
