var umclient;(()=>{var __webpack_modules__={553:(e,t,n)=>{const s=n(622),a=n(682),o=n(464),{qsel:i,drag:r}=n(669),m=n(376);async function c(e){return await s.createTalk(e)}e.exports={umHandleEvents:function(e){},showChat:async function(e){let t=await c(e),n=JSON.parse(t.toidinfo);m.chatpage=0,m.loadHisMsgStatus=!0,m.msgArr=[],m.chatid=n.umid,m.chattype="msg";let s={chatid:n.umid,chattype:"msg",name:n.sumname};o.handleHistoryMsg(s),a.reqclearunread({type:m.chattype,umid:m.umid,chatid:m.chatid})},CreateTalk:c,CreateGroupTalk:async function(e){let t=await s.CreateGroupTalk(e);console.log("send roommsg success",t)}}},464:(module,__unused_webpack_exports,__webpack_require__)=>{const messageModel=__webpack_require__(682),chatModel=__webpack_require__(38),loginModel=__webpack_require__(970),{render,renderList}=__webpack_require__(981),{qsel,createEl,drag}=__webpack_require__(669),umui=__webpack_require__(96),data=__webpack_require__(376),receivedmsg={msg:e=>{handleMsgRev(e)},roommsg:e=>{handleMsgRev(e)}};async function login(e){let t=await loginModel.login(e);data.umid=t.userinfo.umid,data.mysphone=t.userinfo.sphone,data.islogin=!0,t.unreadedcount>0&&qsel("#umsdkBadgeBox")&&(qsel("#umsdkBadgeBox").style.display="inline-block",qsel("#umsdkBadgeText").innerHTML=t.unreadedcount)}async function showMsgList(){if(!data.islogin)return;let e=await messageModel.getMsgList();data.msgListArr=e,e.forEach((e=>{0==e.unread&&(e.isunread="nounread")}));let t=creMsglistDOM(e);qsel("#umsdkMsgBox").appendChild(t)}function handleMsgRev(e){var t=!1;if((e.toumid==data.umid||e.umid==data.umid)&&(!qsel(".umui-dialog-box")||e.umid!=data.chatid&&e.toumid!=data.chatid||(newMsgDOM(e),t=!0),qsel("#umsdkMsgBox")&&(qsel(".umui-dialog-box")||e.umid!=data.chatid||(data.chatid=""),handleNewMsg(e)),e.umid!=data.umid&&!t&&qsel("#umsdkBadgeBox"))){var n=qsel("#umsdkBadgeBox"),s=qsel("#umsdkBadgeText");n&&"none"==n.style.display&&(qsel("#umsdkBadgeBox").style.display="inline-block"),s.innerHTML=parseInt(s.innerHTML)+1}}function scrollDown(){qsel(".his_msg_box").scrollTop=qsel(".his_msg_box").scrollHeight}function handleClickList(e){let{options:t}=e,n=JSON.parse(t);["chatid","chattype"].forEach((e=>data[e]=n[e])),data.msgListArr.forEach((e=>{e.chatid==n.chatid&&(e.unread=0,e.isunread="nounread")})),handleBadgeNum(n);let s=creMsglistDOM(data.msgListArr);qsel("#umsdkMsgBox").innerHTML=s.innerHTML,data.chatpage=0,data.loadHisMsgStatus=!0,data.msgArr=[],messageModel.reqclearunread({type:n.chattype,umid:data.umid,chatid:n.chatid}),handleHistoryMsg(n)}function handleHistoryMsg(e){getHistoryMsg(e).then((e=>{let{info:t,dom:n}=e;data.chatinfo=t,showChatDialog({title:t.name,content:n}),addImgLoad(),scrollDown()}))}function addImgLoad(){document.querySelectorAll(".img_msg").forEach((e=>{e.setAttribute("onload",'umHandleEvents({"cmd":"imgLoad"})')}))}function handleBadgeNum(e){if(qsel("#umsdkBadgeBox")){let t=parseInt(e.unread),n=parseInt(qsel("#umsdkBadgeText").innerHTML);qsel("#umsdkBadgeText").innerHTML=n-t,0==parseInt(qsel("#umsdkBadgeText").innerHTML)&&(qsel("#umsdkBadgeBox").style.display="none")}}function creMsglistDOM(e){let t=__webpack_require__(182),n=__webpack_require__(527),s=renderList(n,e);return createEl(render(t,{msgList:s}))}async function getHistoryMsg(e){let{info:t,msglist:n}=await chatModel.getHistoryMsg(e);if(data.loadHisMsgStatus=n.length>0,data.loadHisMsgStatus){n.forEach((e=>{e.sendumid==data.umid?e.className="send":e.className="get"})),data.msgArr=[...n,...data.msgArr],data.msgArr.forEach((e=>{1==e.type&&-1==e.message.indexOf("img_msg")?e.message=`<img src="${JSON.parse(e.message).fullpath}" class="img_msg" />`:2==e.type&&-1==e.message.indexOf("file_box")&&(e.message=creFileDom(e.message))}));let e=creHisDom({msglist:data.msgArr,info:t});return new Promise((n=>{n({dom:e,info:t})}))}if(0==data.chatpage){let e=creHisDom({msglist:data.msgArr,info:t});return new Promise((n=>{n({dom:e,info:t})}))}}function imgLoad(){0==data.chatpage&&scrollDown()}function creFileDom(e){let t=JSON.parse(e);return JSON.parse(e)instanceof Array&&(t=JSON.parse(e)[0]),`\n    <a href="${t.srcpath||t.fullpath}" target="_blank" title="${t.alias}" download="${t.alias}">\n      <div class="file_box">\n        <div class="logo">\n          <img src="./static/img/file.png" alt="">\n        </div>\n        <div class="file_info">\n          <p class="file_name">${t.alias}</p>\n          <p class="file_size">${t.filesize}</p>\n        </div>\n      </div>\n    </a>\n  `}function loadMoreMsg(e){getHistoryMsg(e).then((e=>{if(e){let{dom:t}=e,n=qsel(".his_msg_box").scrollHeight;qsel(".umui-dialog-content").innerHTML=t.innerHTML;let s=qsel(".his_msg_box").scrollHeight;qsel(".his_msg_box").scrollTop=s-n}}))}function newMsgDOM(e){let{sendtime:t,ischain:n,msg:s,msgid:a,op:o,umidinfo:i,toumid:r,type:m}=e,c={created:t,ischain:n,message:s,msgid:a,op:o,sendinfo:i,toumid:r,type:m};c.sendinfo.umid==data.umid?c.className="send":c.className="get",data.msgArr.push(c),data.msgArr.forEach((e=>{1==e.type&&-1==e.message.indexOf("img_msg")?e.message=`<img src="${JSON.parse(e.message).fullpath}" class="img_msg" />`:2==e.type&&-1==e.message.indexOf("file_box")&&(e.message=creFileDom(e.message))}));let d=creHisDom({msglist:data.msgArr,info:data.chatinfo});qsel(".umui-dialog-content").innerHTML=d.innerHTML,addImgLoad(),scrollDown()}function handleNewMsg(e){if("msg"==e.op&&e.toumid==data.umid&&e.umid!=data.chatid||"roommsg"==e.op&&e.roomid!=data.chatid){var t=!1;if(data.msgListArr.forEach((n=>{(n.chatid==e.umid&&"msg"==e.op||n.chatid==e.roomid&&e.umid!=data.umid&&"roommsg"==e.op)&&(t=!0,n.isunread=void 0,n.unread=parseInt(n.unread)+1)})),!t){let t={type:e.op,msg:e.msg,unread:1};"msg"==e.op?t=Object.assign(t,{avatar:e.umidinfo.avatar,chatid:e.umidinfo.umid,name:e.umidinfo.sumname}):"roommsg"==e.op&&(t=Object.assign(t,{avatar:e.roominfo.logopath,chatid:e.roomid,name:e.roominfo.roomname})),data.msgListArr.unshift(t)}let n=creMsglistDOM(data.msgListArr);qsel("#umsdkMsgBox").innerHTML=n.innerHTML}}function creHisDom({msglist:e,info:t}){let n=__webpack_require__(431),s=__webpack_require__(678),a=__webpack_require__(758),o=__webpack_require__(382),i=renderList(s,e),r=renderList(a,[t]),m=renderList(o,data.emojiList),c=render(n,{historyMsg:i,info:r,emojiList:m});return createEl(c)}async function showChatDialog({title:e,content:t}){umui.dialog({title:e,content:t,area:["1000px","700px"]}),drag(qsel(".umui-dialog"))}async function publicSendMsg(e,t){var n={umid:data.umid,msg:e,msg_type:t,op_type:data.chattype};"msg"==data.chattype?(n.functionname="msg_send",n.toumid=data.chatid):"roommsg"==data.chattype&&(n.functionname="msg_room",n.roomid=data.chatid);let s=await chatModel.sendMsg(n);return messageModel.reqclearunread({type:data.chattype,umid:data.umid,chatid:data.chatid}),s}async function sendMsg(){let e=qsel("#chatText").value;e.length<=0||0==publicSendMsg(e,0).code&&(qsel("#chatText").value="")}function chatScroll(e){let{options:t}=e;0==t.target.scrollTop&&data.loadHisMsgStatus&&(data.chatpage++,data.loadHisMsgStatus=!0,loadMoreMsg({chatid:data.chatid,chattype:data.chattype,name:data.chatinfo.name}))}function msgListScroll(e){let{options:t}=e,n=qsel(".um_msglist").clientHeight,s=document.documentElement.clientHeight,a=t.target.scrollTop;s+a>=n&&data.loadMsgListStatus&&(data.msgListPage++,data.loadMsgListStatus=!0,loadMoreMsgList(a))}function showEmoji(){"none"==qsel("#umEmojiBox").style.display?qsel("#umEmojiBox").style.display="block":qsel("#umEmojiBox").style.display="none"}function clickEmoji(e){let{options:t}=e,n=qsel("#chatText").value;qsel("#chatText").value=n+t}async function loadMoreMsgList(e){let t=await messageModel.getMsgList();if(data.loadMsgListStatus=t.length>0,data.loadMsgListStatus){data.msgListArr=[...data.msgListArr,...t],data.msgListArr.forEach((e=>{0==e.unread&&(e.isunread="nounread")}));let n=creMsglistDOM(data.msgListArr);qsel("#umsdkMsgBox").innerHTML=n.innerHTML,qsel(".msg_list_box").scrollTop=e}}function closeMsgList(){qsel("#umsdkMsgBox").remove()}async function changeFile({options:e}){let t=qsel("#"+e).files;if(t.length>0){let n=new FormData;n.append("filename0",t[0]);let s=await chatModel.uploadFile(n),a=1;"fileInput"==e&&(a=2),publicSendMsg(JSON.stringify(s.result[0]),a),addImgLoad()}}function umHandleEvents(options){options&&options.cmd&&eval(options.cmd+"(options)")}$UMCore.on(["msg"],receivedmsg),module.exports={umHandleEvents,login,handleHistoryMsg,showMsgList}},263:(module,__unused_webpack_exports,__webpack_require__)=>{var umajax=__webpack_require__(767),umUploadFileAjax=__webpack_require__(15);const{_log}=__webpack_require__(669),wholeData=__webpack_require__(376),{getFileServer}=__webpack_require__(65);async function getMsgList({sphone:e,page:t=wholeData.msgListPage,pagesize:n=30}){return new Promise(((s,a)=>{if(wholeData.loadMsgListStatus){wholeData.loadMsgListStatus=!1;let o={data:JSON.stringify({functionname:"chipformessagelist",userid:e,page:t,pagesize:n})};umajax({type:"post",url:"/route.lua",data:o,success:function(e){let t=JSON.parse(e);t.status?(wholeData.loadMsgListStatus=!0,s(t.result)):a({status:t.status,msg:"获取消息列表失败"})},error:e=>{a({status:!1,msg:e})}})}}))}async function reqclearunread({type:e,umid:t,chatid:n}){return new Promise(((s,a)=>{let o={};"msg"==e?o={data:JSON.stringify({functionname:"msg_clearunread",umid:t,toumid:n})}:"roommsg"==e&&(o={data:JSON.stringify({functionname:"msg_clearroomunread",umid:t,roomid:n})}),umajax({type:"post",url:"/route.lua",data:o,success:e=>{let t=JSON.parse(e),{code:n}=t;0==n?s():a({code:t.code,msg:"清除红泡失败"})},error:e=>{a({status:!1,msg:e})}})}))}async function getHistoryMsg({chattype,umid,chatid,page=wholeData.chatpage,pagesize=20}){return new Promise(((resolve,reject)=>{if(wholeData.loadHisMsgStatus){let dataobj={};"msg"==chattype?dataobj={functionname:"msg_getoffline",toumid:chatid}:"roommsg"==chattype&&(dataobj={functionname:"msg_getroommsg",roomid:chatid}),["umid","page","pagesize"].forEach((item=>dataobj[item]=eval(item)));let newdata={data:JSON.stringify(dataobj)};umajax({type:"post",url:"/route.lua",data:newdata,success:function(e){let t=JSON.parse(e);if(0==t.code){let e={};e="roommsg"==chattype?{msglist:t.msglist,info:{name:t.roominfo.roomname,avatar:t.roominfo.logopath}}:{msglist:t.slist,info:{name:t.userto.sumname,avatar:t.userto.avatar}},resolve(e)}else reject({code:t.code,msg:"获取历史消息失败"})},error:e=>{reject({status:!1,msg:e})}})}}))}async function login({No:e,Password:t,Name:n,FG_DeptNo:s,FG_DeptName:a,FG_OrgNo:o,FG_OrgName:i}){return new Promise(((r,m)=>{let c={data:JSON.stringify({functionname:"thirdpartylogin",username:e,password:t,logintype:101,thirdpartydata:{userid:e,orgid:o,orgname:i,deptno:s,deptname:a,username:n}})};umajax({type:"post",url:"/route.lua",data:c,success:function(e){let t=JSON.parse(e),n={token:t.token,userinfo:t.data,unreadedcount:t.unreadlist.unreadedcount};0===t.code?($UMCore.token(t.token),r(n)):m({code:t.code,msg:"登录失败"})},error:e=>{m({status:!1,msg:e})}})}))}async function sendMsg(e){return new Promise(((t,n)=>{let s={data:JSON.stringify(e)};umajax({type:"post",url:"/route.lua",data:s,success:function(e){let n=JSON.parse(e);t(n)},error:e=>{n({status:!1,msg:e})}})}))}async function uploadFile(e){return new Promise(((t,n)=>{umUploadFileAjax({independenceUrl:!0,type:"post",url:getFileServer(),data:e,success:function(e){let n=JSON.parse(e);t(n)},error:e=>{n({status:!1,msg:e})}})}))}async function createTalk(e){return new Promise(((t,n)=>{let s={data:JSON.stringify(e)};umajax({type:"post",url:"/route.lua",data:s,success:function(e){let n=JSON.parse(e);t(n)},error:e=>{n({status:!1,msg:e})}})}))}module.exports={getMsgList,reqclearunread,getHistoryMsg,login,sendMsg,uploadFile,createTalk}},65:(e,t,n)=>{"use strict";function s(){return"https://dapp.umnet.cn"}function a(){return"https://dapp.umnet.cn"}function o(){return"wss://dapp.umnet.cn/websocket"}function i(){return"https://dapp.umnet.cn/files.lua?a=v2"}n.r(t),n.d(t,{getReqUrl:()=>s,getHostUrl:()=>a,getWShost:()=>o,getFileServer:()=>i})},376:(e,t,n)=>{const s=n(661),{emojify:a}=n(669);let o={umid:"",mysphone:"",islogin:!1,chatid:"",chattype:"",chatinfo:{},msgListArr:[],msgArr:[],chatpage:0,loadHisMsgStatus:!0,msgListPage:0,loadMsgListStatus:!0,emojiList:[]};s.emojiList.forEach((e=>{o.emojiList.push({emoji:a(e.emoji),emojiname:e.name})})),e.exports=o},661:e=>{var t=[{emoji:"😊",name:"微笑"},{emoji:"😔",name:"沉思"},{emoji:"😍",name:"花痴"},{emoji:"😎",name:"墨镜笑脸"},{emoji:"😭",name:"大哭"},{emoji:"😃",name:"哈哈"},{emoji:"🤐",name:"闭嘴"},{emoji:"😪",name:"困"},{emoji:"😡",name:"愤怒"},{emoji:"😜",name:"调皮"},{emoji:"😬",name:"呲牙"},{emoji:"😮",name:"吃惊"},{emoji:"😞",name:"失望"},{emoji:"😱",name:"吓死了"},{emoji:"😩",name:"累死了"},{emoji:"🤢",name:"恶心"},{emoji:"😠",name:"生气"},{emoji:"😂",name:"笑哭"},{emoji:"😤",name:"傲慢"},{emoji:"😴",name:"睡着"},{emoji:"😲",name:"震惊"},{emoji:"🙄",name:"白眼"},{emoji:"😓",name:"汗"},{emoji:"😵",name:"晕"},{emoji:"🤧",name:"打喷嚏"},{emoji:"😷",name:"感冒"},{emoji:"💊",name:"药丸"},{emoji:"😘",name:"飞吻"},{emoji:"🤗",name:"抱抱"},{emoji:"😚",name:"羞涩亲亲"},{emoji:"😉",name:"眨眼"},{emoji:"😌",name:"松了口气"},{emoji:"😋",name:"好吃"},{emoji:"🤤",name:"流口水"},{emoji:"🤓",name:"书呆子脸"},{emoji:"😩",name:"累死了"},{emoji:"😣",name:"痛苦"},{emoji:"🤐",name:"闭嘴"},{emoji:"🤑",name:"发财"},{emoji:"👄",name:"嘴"},{emoji:"💗",name:"心"},{emoji:"💔",name:"心碎"},{emoji:"👍",name:"强"},{emoji:"👎",name:"弱"},{emoji:"🤝",name:"握手"},{emoji:"👏",name:"鼓掌"},{emoji:"👆",name:"向上"},{emoji:"👇",name:"向下"},{emoji:"👊",name:"拳头"},{emoji:"💪",name:"加油"},{emoji:"👌",name:"OK"},{emoji:"🙏",name:"合十"},{emoji:"🤞",name:"比心"},{emoji:"🍺",name:"啤酒"},{emoji:"🍻",name:"干杯"},{emoji:"🥂",name:"碰杯"},{emoji:"🍵",name:"热茶"},{emoji:"🍰",name:"蛋糕"},{emoji:"🌹",name:"玫瑰"},{emoji:"🥀",name:"凋谢"},{emoji:"🌸",name:"樱花"},{emoji:"💣",name:"炸弹"},{emoji:"🔪",name:"刀"},{emoji:"🌞",name:"太阳"},{emoji:"🌙",name:"月亮"},{emoji:"💥",name:"爆炸"},{emoji:"🎁",name:"礼物"},{emoji:"📦",name:"包裹"},{emoji:"🎈",name:"气球"},{emoji:"💰",name:"钱袋"},{emoji:"👛",name:"钱包"},{emoji:"🐷",name:"猪头"},{emoji:"😺",name:"大笑猫"},{emoji:"😻",name:"花痴猫"},{emoji:"👿",name:"恶魔"},{emoji:"💘",name:"丘比特"},{emoji:"🙃",name:"倒脸"},{emoji:"😆",name:"斜眼笑"},{emoji:"😇",name:"天使"},{emoji:"💎",name:"宝石"},{emoji:"📞",name:"电话"}];function n(e){let n=t.find((t=>t.name===e));return n?n.emoji:e}const s={emojiList:t,emoji2text:function(e){let n=t.find((t=>t.emoji===e));return n?"["+n.name+"]":e},text2emoji:n,replaceEmojiText:function(e){return e.replace(/\[(.*?)\]/gi,((e,t)=>n(t)))},replaceEmoji:function(e){let n=e;return t.forEach((e=>{n=n.replace(e.emoji,"["+e.name+"]")})),n}};e.exports=s},981:e=>{function t(e,t){return e.replace(/[#]{([^}]+)}/g,(function(e,n){return n.split(".").reduce(((e,t)=>e&&e[t]),t)}))}e.exports={render:t,renderList:function(e,n){let s=[];return n.forEach((n=>{s.push(t(e,n))})),s.join("")}}},767:(e,t,n)=>{const{getReqUrl:s}=n(65),{getStorage:a}=n(669);e.exports=function(e){(e=e||{}).type=(e.type||"GET").toUpperCase(),e.dataType=e.dataType||"json",e.data.deviceId=a("umsdk_deviceId")||void 0,e.data.websocket_name=a("umsdk_ws_name")||void 0;var t,n=s()+e.url,o=function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(e.data);window.XMLHttpRequest?t=new XMLHttpRequest:window.ActiveObject&&(t=new ActiveXobject("Microsoft.XMLHTTP")),"GET"==e.type?(t.open("GET",n+"?"+o,!0),t.send(null)):"POST"==e.type&&(t.open("post",n,!0),t.setRequestHeader("accept","*/*"),sessionStorage.getItem("umsdk-token")&&t.setRequestHeader("Authorization",sessionStorage.getItem("umsdk-token")),t.send(o)),t.onreadystatechange=function(){if(4==t.readyState){var n=t.status;n>=200&&n<300||304==n?e.success&&e.success(t.responseText,t.responseXML):e.error&&e.error(n)}}}},9:e=>{e.exports=function(e){var t,n=e.$UMCore,s=null,a={listeners:{umnode:[{process:function(e,t){if(0===e.code)return console.log("umnode is ready, start init umcore.js library, device id is:"+m()),a.ws_name=e.name,u("umsdk_ws_name",a.ws_name),u("umsdk_deviceId",m()),!0},on_receive:function(e,t){e.code<0&&console.warning("ummsg.code<0, clear token")}}]},websocket:void 0,error:void 0,sessionid:void 0,jwtToken:"",ws_name:"",ping_count:0,deviceid:""};function o(e,t,n){if(e){if(n)switch(n){case"object":return e.hasOwnProperty(t)&&"object"==typeof e[t];case"string":return e.hasOwnProperty(t)&&"string"==typeof e[t];case"function":return e.hasOwnProperty(t)&&"function"==typeof e[t];default:return!1}return e.hasOwnProperty(t)}return!1}function i(e,t,n){if(o(e,"process","function"))return e.process(t,n);{let s=t.cmd+"."+t.op;if(o(e,t.op,"function"))return e[t.op](t,n);if(o(e,s,"function"))return e[s](t,n)}}function r(e){return new Promise((function(t,n){console.log("connecting to ws server...");var m=("https:"===location.protocol?"wss:":"ws:")+"//"+window.location.host+"/websocket";e.config&&e.config.wshost&&(m=e.config.wshost);var c=new WebSocket(m);a.websocket=c,c.onopen=function(n){console.log("websocket connect success!"),u("network",!0),s.token(l("umsdk-token")),t(e)},c.onmessage=function(t){if("pong"!==t.data){var n=JSON.parse(t.data);if("string"==typeof n){let e=JSON.parse(n);e&&(n=e)}!function(e,t){if("string"==typeof e&&(e=JSON.parse(e)),o(e,"cmd","string")){var n=!1;if(o(a.listeners,e.cmd,"object")){var s=a.listeners[e.cmd];Array.isArray(s)?s.forEach((function(s){var a=i(s,e,t);n||(n=a)})):n=i(s,e,t)}n||console.warn("no local processer for ummsg:",e)}else console.warn("error ummsg format:",e)}(n,e)}else a.ping_count=0},c.onerror=function(e){a.websocket=null,console.log("websocket is error:",e),u("network",!1),n(e)},c.onclose=function(t){console.log("websocket is closed:",t,", try connect after 3 secends..."),setTimeout(r,3e3,e)}}))}function m(){if(a.deviceid)return a.deviceid;let e=l("devid");return e||(e="_"+Math.random().toString(36).substr(2,9),u("umsdk_devid",e)),a.deviceid=e,e}function c(e,t,n){var s;if(n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),s="; expires="+a.toGMTString()}else s="";document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+"; path=/"}function d(e){for(var t=encodeURIComponent(e)+"=",n=document.cookie.split(";"),s=0;s<n.length;s++){for(var a=n[s];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return decodeURIComponent(a.substring(t.length,a.length))}return null}function l(e){return sessionStorage.getItem(e)}function u(e,t){sessionStorage.setItem(e,t)}return e.$UMCore=(s=t={noConflict:function(){return e.$Umcore=n,t},init:function(e){return s.config=e,r(s).then((function(){return s}))},on:function e(t,n){var s=a.listeners;if(Array.isArray(t))t.forEach((function(t,s){e(t,n)}));else{if(!o(s,t,"object"))return void(s[t]=[n]);var i=0,r=!1;for(i=0;i<s[t].length;i++){var m=s[t][i];if(m===n||n.__event_name&&n.__event_name===m.__event_name){r=!0;break}}r?s[t][i]=n:s[t].push(n)}},session:function(e){if(void 0===e)return a.sessionid=d("session"),a.sessionid;var t;t=e,a.sessionid=t,c("session",t)},cookie:d,setCookie:c,delCookie:function(e){c(e,"",-1)},token:function(e){if(!e)return a.jwtToken||(a.jwtToken=l("umsdk-token")),a.jwtToken;u("umsdk-token",e),a.jwtToken=e,a.websocket.send(JSON.stringify({devid:m(),token:e}))},data:a,deviceId:m},window&&window.setInterval((function(){a.websocket&&a.websocket.readyState===WebSocket.OPEN&&(a.websocket.send("ping"),a.ping_count++,a.ping_count>=3&&(a.websocket.close(),a.ping_count=0))}),1e4),t),s}},96:(e,t,n)=>{const{qsel:s}=n(669);var a={rightclose:function(e){s("#"+e).style.display="none"},dialog:function(e){var{title:t="弹窗",content:n="",btn:a=[],confirm:o,close:i,area:r=["50%","50%"]}=e,m=(new Date).getTime(),c="";a&&a.length&&(c+='<div class="dialog-bottom">',a.forEach((e=>{c+=`<div class="umui-btn umui-btn-mini qsel{index==0?'umui-btn-primary':''}" οnclick="qsel{index==0?'_confirm()':'_close()'}">${e}</div>`})),c+="</div>");var d=document.createElement("div");return d.setAttribute("id",`umui-${m}-box`),d.innerHTML=`<div id="umui-${m}" class="umui-dialog-box">\n      <div class="umui-masking-layer">\n        <div class="umui-dialog" style="width:${r[0]};height:${r[1]}">\n          <div class="umui-dialog-head">\n            <span></span>\n            <span>${t}</span>\n            <img class="dialog_close" onclick="document.querySelector('#umui-${m}-box').remove();" src="./static/img/close.png" alt="">\n          </div>\n          <div class="umui-dialog-content">\n            ${n.innerHTML||""}\n          </div>\n          ${c}\n        </div>\n      </div>\n    </div>`,s("body").append(d),s("#umui-"+m)[0]},mdialog:function(e){var{title:t="弹窗",content:n=""}=e,a=(new Date).getTime(),o=document.createElement("div");return o.setAttribute("id",`umui-${a}-box`),o.innerHTML=`<div id="umui-${a}" class="umui-dialog-box">\n       <div class="umui-masking-layer" style="height:100%;">\n        <div class="umui-dialog-head">\n          <img class="dialog_close" src="./static/img/back.png" onclick="document.querySelector('#umui-${a}-box').remove();" />\n          <span>${t}</span>\n          <span style="width:20px;"></span>\n        </div>\n        <div class="umui-dialog-content">\n          ${n.innerHTML||""}\n        </div>\n       </div>\n     </div>`,s("body").append(o),s("#umui-"+a)[0]}};e.exports=a},15:(e,t,n)=>{const{getReqUrl:s}=n(65),{getStorage:a}=n(669);e.exports=function(e){(e=e||{}).type=(e.type||"GET").toUpperCase(),e.dataType=e.dataType||"json";var t,n=e.url,s=e.data;window.XMLHttpRequest?t=new XMLHttpRequest:window.ActiveObject&&(t=new ActiveXobject("Microsoft.XMLHTTP")),"POST"==e.type&&(t.open("post",n,!0),t.setRequestHeader("accept","*/*"),sessionStorage.getItem("umsdk-token")&&t.setRequestHeader("Authorization",sessionStorage.getItem("umsdk-token")),t.send(s)),t.onreadystatechange=function(){if(4==t.readyState){var n=t.status;n>=200&&n<300||304==n?e.success&&e.success(t.responseText,t.responseXML):e.error&&e.error(n)}}}},669:(e,t,n)=>{"use strict";n.r(t),n.d(t,{_log:()=>a,_error:()=>o,qsel:()=>i,setStorage:()=>r,getStorage:()=>m,createEl:()=>c,createElList:()=>d,htmlStr:()=>l,handleImg:()=>u,creDOM:()=>g,drag:()=>p,emojify:()=>f});const{getReqUrl:s}=n(65);function a(){console.stdlog.apply(console,arguments)}function o(){console.stderror.apply(console,arguments)}function i(e){return document.querySelector(e)}function r(e,t){return sessionStorage.setItem(e,t)}function m(e){return sessionStorage.getItem(e)}function c(e){let t=document.createElement("div");return t.innerHTML=e,t.firstChild}function d(e){let t=document.createElement("div");return t.innerHTML=e,t.childNodes}function l(e){return div.innerHTML}function u(e){return-1==e.indexOf("https")||-1==e.indexOf("http")?s()+e:e}function g(e,t="",n=""){var s=document.createElement(e);return s.setAttribute("class",t),s.setAttribute("id",n),s}function p(e){var t=0,n=0;e.onmousedown=function(s){var a=s||window.event;t=a.clientX-e.offsetLeft,n=a.clientY-e.offsetTop,document.onmousemove=function(s){var a=s||window.event;e.style.left=a.clientX-t+"px",e.style.top=a.clientY-n+"px"},e.onmouseup=function(){document.onmousemove=null}}}function f(e,t){t||(t={folder:"svg",ext:".svg"});let n=navigator.appVersion.match(/windows \w+? (\d+)(\.\d)*/i);return window.twemoji&&n&&n.length>1&&Number(n[1])<=8?".txt"===t.ext?emojitools.replaceEmoji(e):window.twemoji.parse(e,t):e}console.stdlog=console.log.bind(console),console.stderror=console.error.bind(console)},225:(e,t,n)=>{const s=n(9),{getHostUrl:a,getWShost:o}=n(65),{qsel:i,creDOM:r}=n(669),m=n(376);let c=[],d=null,l=null;e.exports={init:function(e,t,m=window){s(m).init({host:a(),wshost:o()}).then((s=>{console.log("umcore init ok"),setTimeout((()=>{!async function(e,t){t&&function(e){var t=r("div","umsdk_badge","umsdkBadgeBox"),n=r("sup","umsdk_badge_text","umsdkBadgeText");t.setAttribute("style","display:none;"),n.innerHTML=0,t.appendChild(n),i(e).appendChild(t)}(t),d=n(464),l=n(553),c=[d,l],await d.login(e)}(e,t)}),0)})).catch((e=>{console.log("umcore init fail ",e)})),m.umHandleEvents=e=>{c.forEach((t=>t.umHandleEvents(e)))}},OpenMsgPanel:function(){if(umclient&&!i("#umsdkMsgBox")&&d){if(!m.islogin)return;!function(){let e=document.createElement("div");e.setAttribute("id","umsdkMsgBox"),e.setAttribute("style","display:block;"),i("body").appendChild(e)}(),d.showMsgList()}},OpenChat:function(e){if(!umclient)return;let t={orgid:e.FG_OrgNo,umid:e.No,toumid:e.toNo,toUserName:e.toName,msg:e.msg,url:e.url||""};l.showChat(t)},CreateTalk:function(e){l.CreateTalk(e)},CreateGroupTalk:function(e){l.CreateGroupTalk(e)}}},38:(e,t,n)=>{const s=n(263),a=n(376);e.exports={getHistoryMsg:async function(e){return await s.getHistoryMsg({umid:a.umid,chattype:e.chattype,chatid:e.chatid})},sendMsg:async function(e){return await s.sendMsg(e)},uploadFile:async function(e){return await s.uploadFile(e)}}},622:(e,t,n)=>{const s=n(263);n(376),e.exports={createTalk:async function({orgid:e,toumid:t,umid:n,toUserName:a,msg:o,url:i}){let r={functionname:"thirdpartymsg",sendphone:n,tophone:t,msg_type:0,msg:o,orgid:e,toname:a,prottype:101,url:i};return await s.createTalk(r)},CreateGroupTalk:async function({orgid:e,umid:t,roomid:n,roomname:a,phonelist:o,msg:i,url:r}){let m="";o instanceof Array?m=o:"[object String]"==Object.prototype.toString.call(o)&&(m=o.split(","));let c={functionname:"thirdpartyroommsg",sendphone:t,roomid:n,msg_type:0,roomname:a,msg:i,orgid:e,prottype:101,phonelist:m,url:r};return await s.createTalk(c)}}},970:(e,t,n)=>{const s=n(263);e.exports={login:async function(e){return await s.login(e)}}},682:(e,t,n)=>{const s=n(263),a=n(376);e.exports={getMsgList:async function(){return(await s.getMsgList({sphone:a.mysphone})).map((e=>({type:e.msgs.op,msg:e.msgs.message,avatar:"roommsg"==e.msgs.op?e.roominfo.logopath:e.users.avatar,name:"roommsg"==e.msgs.op?e.roominfo.roomname:e.users.sumname,chatid:"roommsg"==e.msgs.op?e.roominfo.roomid:e.users.umid,unread:e.unreaded})))},reqclearunread:async function(e){return await s.reqclearunread(e)}}},431:e=>{"use strict";e.exports='<div class="msg_box" id="umsdkMsgBox">\r\n  <div class="chat_userinfo">\r\n    #{info}\r\n  </div>\r\n  <div class="his_msg_box" onscroll="umHandleEvents({\'options\':event, \'cmd\':\'chatScroll\'})">\r\n    <ul id="msgListUl" class="msg_list_ul">\r\n      #{historyMsg}\r\n    </ul>\r\n  </div>\r\n  <div class="chat_bottom">\r\n    <div class="um_emoji_box" id="umEmojiBox" style="display: none;">\r\n      <ul>\r\n        #{emojiList}\r\n      </ul>\r\n    </div>\r\n    <div class="func">\r\n      <ul>\r\n        <li>\r\n          <img src="./static/img/emojiIcon.png" title="表情" onclick="umHandleEvents({\'cmd\':\'showEmoji\'})" alt="">\r\n        </li>\r\n        <li>\r\n          <img src="./static/img/imgIcon.png" title="图片" alt="">\r\n          <input type="file" class="file_input" id="imgInput" accept="image/*" onchange="umHandleEvents({\'options\':\'imgInput\',\'cmd\':\'changeFile\'})" title="图片" name="" />\r\n        </li>\r\n        <li>\r\n          <img src="./static/img/fileIcon.png" title="文件" alt="">\r\n          <input type="file" class="file_input" id="fileInput" onchange="umHandleEvents({\'options\':\'fileInput\',\'cmd\':\'changeFile\'})" title="文件" name="" />\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <div class="editor">\r\n      <textarea class="text_area" id="chatText"></textarea>\r\n    </div>\r\n    <div class="send_btn_box">\r\n      <button class="send_btn" onclick="umHandleEvents({\'options\':\'{}\', \'cmd\':\'sendMsg\'})">发送</button>\r\n    </div>\r\n  </div>\r\n</div>\r\n'},758:e=>{"use strict";e.exports='<img src="#{avatar}" alt="" onerror="this.src=\'./static/img/user/defaultIcon1.png\'" />\r\n<span>#{name}</span>'},678:e=>{"use strict";e.exports='<li class="#{className}">\r\n  <img src="#{sendinfo.avatar}" alt="" class="avatar" onerror="this.src=\'./static/img/user/defaultIcon1.png\'" />\r\n  <div class="msg_content msg_#{type}">#{message}</div>\r\n</li>'},382:e=>{"use strict";e.exports="<li onclick=\"umHandleEvents({'options':'#{emoji}', 'cmd':'clickEmoji'})\" title=\"#{emojiname}\">#{emoji}</li>"},182:e=>{"use strict";e.exports='<div class="um_box">\r\n  <div class="um_header">\r\n    <span></span>\r\n    <span>消息</span>\r\n    <img class="close" onclick="umHandleEvents({\'options\':\'{}\',\'cmd\':\'closeMsgList\'})" src="./static/img/close.png" alt="">\r\n  </div>\r\n  <div class="msg_list_box" onscroll="umHandleEvents({\'options\':event, \'cmd\':\'msgListScroll\'})">\r\n    <ul class="um_msglist">\r\n      #{msgList}\r\n    </ul>\r\n  </div>\r\n</div>\r\n'},527:e=>{"use strict";e.exports="<li onclick=\"umHandleEvents({'options':JSON.stringify({'chattype':'#{type}','name':'#{name}','chatid':'#{chatid}', 'unread':'#{unread}'}), 'cmd': 'handleClickList'})\">\r\n  <div>\r\n    <img class=\"avatar\" src=\"#{avatar}\" alt=\"\" onerror=\"this.src='./static/img/user/defaultIcon1.png'\">\r\n    <span class=\"name\">#{name}</span>\r\n  </div>\r\n  <div class=\"unread #{isunread}\">#{unread}</div>\r\n</li>\r\n"}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(225);umclient=__webpack_exports__})();