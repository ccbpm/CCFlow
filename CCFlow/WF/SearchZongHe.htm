<!DOCTYPE html
          PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>ÊµÅÁ®ãÁªºÂêàÊü•ËØ¢</title>
    <script src="./Scripts/vue.js"></script>
    <!-- Element Ui -->
    <link rel="stylesheet" href="./Scripts/element/element.css" />
    <link href="Style/skin/css/style.css" rel="stylesheet" type="text/css" />
    <link href="Style/skin/css/animate.css" rel="stylesheet" type="text/css" />
    <script src="./Scripts/element/element.js"></script>
    <script type="text/javascript" src="Scripts/bootstrap/js/jquery.min.js"></script>
    <script src="Scripts/QueryString.js"></script>
    <script src="Scripts/config.js" type="text/javascript"></script>
    <script type="text/javascript" src="Comm/Gener.js"></script>
    <script type="text/javascript" src="Scripts/dayjs.min.js"></script>
    <script type="text/javascript" src="Scripts/dayjs/duration.js"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }

        #app {
            background-color: white;
        }

        /* Ê†∑ÂºèË¶ÜÁõñ */
        .el-table__header {
            width: 100% !important;
        }

        .el-table__body {
            width: 100% !important;
        }

        /* Ëá™ÂÆö‰πâ */
        .box {
            margin: 20px 10px;
        }

            .box .content {
                padding-right: 40px;
            }

        .f-left {
            float: left;
        }

        .title {
            line-height: 40px;
        }

        .search-box {
            margin: 15px 0;
        }
    </style>
</head>

<body class="gray-bg">
    <div id="app" class="wrapper wrapper-content animated fadeInRight">
        <div class="box ibox-content">
            <div>
                <div class="f-left title">ÂÖ≥ÈîÆÂ≠óÔºö</div>
                <div class="f-left content">
                    <el-input v-model="keyWord" placeholder="ËØ∑ËæìÂÖ•ÂÜÖÂÆπ"></el-input>
                </div>
            </div>
            <div>
                <div class="f-left title">Êó•Êúü‰ªéÔºö</div>
                <div class="f-left content">
                    <el-date-picker v-model="date" type="daterange" range-separator="Ëá≥" start-placeholder="ÂºÄÂßãÊó•Êúü"
                                    end-placeholder="ÁªìÊùüÊó•Êúü" value-format="yyyy-MM-dd">
                    </el-date-picker>
                </div>
            </div>
            <div>
                <div class="f-left title">Áä∂ÊÄÅÔºö</div>
                <div class="f-left content">
                    <el-select v-model="status" placeholder="ËØ∑ÈÄâÊã©">
                        <el-option v-for="item in statusOpt" :key="item.value" :label="item.label" :value="item.value">
                        </el-option>
                    </el-select>
                </div>
            </div>
            <div>
                <el-button type="primary" icon="el-icon-search" @click="onSearch">ÊêúÁ¥¢</el-button>
            </div>
        </div>
        <el-table :data="tableData" border=border style="width: 100%;">
            <el-table-column prop="no" label="Â∫èÂè∑" type="index" />
            </el-table-column>
            <el-table-column prop="Title" label="Ê†áÈ¢ò" />
            </el-table-column>
            <el-table-column prop="flow" label="ÊµÅÁ®ã/ÂÅúÁïôËäÇÁÇπ" />
            </el-table-column>
            <el-table-column prop="StarterName" label="ÂèëËµ∑‰∫∫" />
            </el-table-column>
            <el-table-column prop="initiateDate" label="ÂèëËµ∑Êó•Êúü" />
            </el-table-column>
            <el-table-column prop="lastDate" label="ÊúÄÂêéÊó•Êúü" />
            </el-table-column>
            <el-table-column prop="time" label="ËÄóÊó∂" />
            </el-table-column>
            <el-table-column prop="status" label="Áä∂ÊÄÅ" />
            </el-table-column>
        </el-table>
    </div>
</body>
<script type="text/javascript">
    new Vue({
        el: '#app',
        data: function () {
            return {
                tableData: [
                    {
                        Title: 'Ê†áÈ¢ò',
                        flow: 'ÊµÅÁ®ã/ÂÅúÁïôËäÇÁÇπ',
                        StarterName: 'ÂèëËµ∑‰∫∫',
                        initiateDate: 'ÂèëËµ∑Êó•Êúü',
                        lastDate: 'ÊúÄÂêéÊó•Êúü',
                        time: 'ËÄóÊó∂',
                        status: 'Áä∂ÊÄÅ'
                    }
                ],
                statusOpt: [{
                    value: 'all',
                    label: 'ÂÖ®ÈÉ®'
                }, {
                    value: '2',
                    label: 'ËøêË°å‰∏≠'
                }, {
                    value: '5',
                    label: 'ÈÄÄÂõû'
                }, {
                    value: '3',
                    label: 'Â∑≤ÂÆåÊàê'
                }],
                status: 'all',
                date: '', // elementÁî®Êà∑ÁÇπÂáªÊ∏ÖÈô§‰ºöÁΩÆ‰∏∫null
                keyWord: ''
            }
        },
        methods: {
            onSearch: function () {
                this.search(
                    this.keyWord,
                    this.date ? this.date[0] + ' 00:00:00' : '',
                    this.date ? this.date[1] + ' 23:59:59' : '',
                    "",
                    this.status
                );
            },
            search: function (
                Key = "",
                DTFrom = "",
                DTTo = "",
                FlowNo = "",
                WFState = ""
            ) {
                //ÊâßË°åÊü•ËØ¢.
                const handler = new HttpHandler("BP.WF.HttpHandler.WF");
                handler.AddPara("Key", Key);
                handler.AddPara("DTFrom", DTFrom);
                handler.AddPara("DTTo", DTTo);
                handler.AddPara("FlowNo", FlowNo);
                handler.AddPara("WFState", WFState);
                const data = handler.DoMethodReturnJSON("SearchZongHe_Init");
                console.log(`üöÄ :: data`, data);
                this.handleData(data);
            },
            handleData: function (data) {
                const now = dayjs();
                this.tableData = data.map(item => {
                    item.flow = `${item.FlowName}/${item.NodeName}`;
                    item.initiateDate = item.RDT.substring(0, 16);
                    item.lastDate = item.SendDT.substring(0, 16);
                    // ËÄóÊó∂ Â∑≤ÂÆåÊàê ÊåâÁÖß RDT , Send DT‰∏§‰∏™Êó∂Èó¥Â∑ÆËÆ°ÁÆó
                    let diffm;
                    if (item.WFState == 3) {
                        diffm = dayjs(item.SendDT).diff(dayjs(item.RDT));
                    } else {
                        //diffm = dayjs.duration(dayjs().diff(dayjs(item.RDT)))
                    }
                    //const dayObj = dayjs.duration(diffm).$d.$ds;
                    //item.time = `${dayObj.days}Â§©${dayObj.hours}Êó∂${dayObj.minutes}ÂàÜ`
                    /*
                        dayjs diff
                        now > SendDT Ê≠£
                        now < SendDT Ë¥ü
                    */
                    if (item.WFState == 2) {
                        item.status = now.diff(dayjs(item.SDTOfNode)) <= 0 ? 'ËøêË°å‰∏≠' : 'Â∑≤ÈÄæÊúü';
                    } else if (item.WFState == 3) {
                        item.status = 'Â∑≤ÂÆåÊàê'
                    } else if (item.WFState == 5) {
                        item.status = 'ÈÄÄÂõû'
                    } else {
                        item.status = 'ÂÖ∂‰ªñ'
                    }

                    return item;
                })
                console.log(`üöÄ :: this.tableData`, this.tableData);
            }
        },
        created() {
            dayjs.extend(dayjs_plugin_duration);
        },
        mounted() {
            this.search();
        }
    })
</script>

</html>