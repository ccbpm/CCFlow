<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>授权详细信息-驰骋工作流程管理系统</title>
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <link href="../Scripts/bootstrap/css/bootstrap.css" rel="stylesheet" />
    <link href="../Scripts/bootstrap/css/components-rounded.css" rel="stylesheet" />
    <link href="../Scripts/bootstrap/css/font-awesome.css" rel="stylesheet" />
    <link href="../Scripts/bootstrap/css/themes/default/style.min.css" rel="stylesheet" />
    <script type="text/javascript" src="../Scripts/QueryString.js"></script>
    <script type="text/javascript" src="../Scripts/QueryString2016.js"></script>
    <script type="text/javascript" src="../Scripts/bootstrap/js/jquery.min.js"></script>
    <script type="text/javascript" src="../Scripts/bootstrap/js/jquery.cokie.min.js"></script>
    <script type="text/javascript" src="../Scripts/bootstrap/js/bootstrap.min.js"></script>
    <!-- 导入配置文件. -->
    <script type="text/javascript" src="../Scripts/config.js"></script>
    <script type="text/javascript" src="../Comm/Gener.js"></script>
    <script type="text/javascript" language="javascript">
        //页面启动函数.
        var webUser = null;
        var emp = null;

        $(function () {

            BindPop();

            var webUser = new WebUser();
            emp = new Entity("BP.WF.Port.WFEmp", webUser.No);

            $("#TB_Author").val(emp.Author); //设置授权人.
            $("#TB_DT").val(emp.AuthorDate); //授权到日期.
            $("#DDL_AuthorWay").val(emp.AuthorWay); //授权方式.

            $('#Btn_Auto').bind('click', function () { $('#selectEmpsModal').modal().show(); });

        });

        //设置选中的人员
        function selectEmpsWindowClose(data) {

            $('#selectEmpsModal').modal('hide');
            if (data == '取消') {
                return;
            }

            var no = frames["iframeSelectEmpsForm"].window.returnVal.No;
            $("#TB_Author").val(no);
        }


        function BindPop() {

            var dept = getQueryStringByNameFromUrl("?" + $.cookie('CCS'), "FK_Dept");
            if (dept == null || dept == '' || dept == undefined) {
                dept = $.cookie('FK_Dept');
            }
            if (dept == undefined) {
                var u = new WebUser();
                dept = u.FK_Dept;
            }
            var url = "../WorkOpt/SelectEmps.htm?FK_Dept=" + dept + "&FK_Node=" + GetQueryString("FK_Node") + "&s=" + Math.random();
            //  url = url.replace('101', '10102');
            url = url.replace('=101&', '=10102&');
            $('#iframeSelectEmpsForm').attr('src', url);
        }


        //执行保存.
        function Save() {

            emp.Author = $("#TB_Author").val();
            emp.AuthorDate = $("#TB_DT").val();
            emp.AuthorWay = $("#DDL_AuthorWay").val();
            emp.Update();

            alert('保存成功');
            window.location.href = 'Default.htm';

        }
    </script>
</head>
<body onkeypress="Esc()" class="gray-bg">
    <form id="cc" name="cc">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="ibox float-e-margins">
            <div class="ibox-content">
                <div class="usercenter">
                    <h4>授权详细信息</h4></div>

                <div class="form-horizontal">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">
                            授权给</label>
                        <div class="col-sm-4">
                            <input type="text" id="TB_Author" name="TB_Author" class="form-control" />
                        </div>
                        <div class="col-sm-4">
                            <input type="button" value="选择授权人" id="Btn_Auto" class="btn btn-default" />
                        </div>
                    </div>
                    <div class="form-group"  style=" visibility:hidden; ">
                        <label class="col-sm-3 control-label">
                            收回授权日期:</label>
                        <div class="col-sm-8">
                            <input name="TB_DT" type="text" class="form-control"  value="2099-01-01 01:01" maxlength="20"
                                id="TB_DT"  onfocus="WdatePicker({dateFmt:yyyy-MM-dd;});" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">
                            授权方式</label>
                        <div class="col-sm-8">
                            <select name="DDL_AuthorWay" class="form-control" id="DDL_AuthorWay">
                                <option selected="selected" value="0">不授权</option>
                                <option value="1">全部流程授权</option>
                                <option value="2">指定流程授权</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">

                        <label class="col-sm-3 control-label" >
                            <a href="javascript:alert('该功能在翻译中..');" >设置要授权的流程范围</a></label>


                        <div class="col-sm-8">
                            <input type="button" name="Btn_Save" value="保存" id="Btn_Save" class="btn btn-info"
                                onclick="Save();" />
                            <a class="btn btn-white" href="Default.htm">返回</a></div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-3 col-sm-8">
                            <span class="fred">说明:</span>在您确定了收回授权日期后，被授权人不能再以您的身份登陆，如果未到指定的日期您可以取回授权。
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 弹出窗台.. -->
        <div class="modal fade" id="selectEmpsModal">
            <div class="modal-dialog">
                <div class="modal-content" style="border-radius: 0px; width: 700px;">
                    <div class="modal-header">
                        <button type="button" class="close" style="color: white; opacity: 1;" data-dismiss="modal"
                            aria-hidden="true">
                            &times;</button>
                        <h4 class="modal-title">
                            选择会签人</h4>
                    </div>
                    <div class="modal-body">
                        <iframe style="width: 100%; border: 0px; height: 400px;" id="iframeSelectEmpsForm"
                            name="iframeSelectEmpsForm"></iframe>
                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>
    </form>
</body>
</html>
