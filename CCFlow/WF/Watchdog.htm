<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>流程监控</title>
    <!--<link href="Scripts/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="Scripts/bootstrap/css/font-awesome.css" rel="stylesheet">
    <link href="./Style/skin/css/style.css" rel="stylesheet" type="text/css" />
    <link href="./Style/skin/font/iconfont.css" rel="stylesheet" type="text/css" />-->

    <link href="Scripts/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="Scripts/bootstrap/css/font-awesome.css" rel="stylesheet" />
    <link href="Style/skin/css/style.css" rel="stylesheet" type="text/css" />
    <link href="Style/skin/css/animate.css" rel="stylesheet" type="text/css" />
    <link href="Style/skin/font/iconfont.css" rel="stylesheet" type="text/css" />

    <script type="text/javascript" src="Scripts/bootstrap/js/jquery.min.js"></script>
    <script type="text/javascript" src="Scripts/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="Style/skin/js/mp.mansory.min.js"></script>
    <script src="Style/skin/layui/layer.js" type="text/javascript"></script>
    <script src="Scripts/QueryString.js"></script>
    <script src="Scripts/config.js" type="text/javascript"></script>
    <script src="Comm/Gener.js" type="text/javascript"></script>
    <link href="../DataUser/Style/ccbpm.css" rel="stylesheet" />
    <!-- 处理多语言 -->
    <script src="Data/lang/load.js" type="text/javascript"></script>
    <script src="Data/lang/lang.js" type="text/javascript"></script>

    <script language="javascript" type="text/javascript">

        //页面启动函数.
        var webUser = new WebUser();
        $(function () {
            document.title = window.lang.fqxlc;
            InitPage();
        });

        //初始化数据.
        function InitPage() {

            $('#docs').html(window.lang.loading);
            debugger;
            var handler = new HttpHandler("BP.WF.HttpHandler.WF");
            var data = handler.DoMethodReturnString("Watchdog_Init");
            if (data.indexOf('err@') == 0) {
                alert(data);
                return;
            }

            /* var sql = "SELECT * FROM WF_EMP WHERE No='" + webUser.No + "'";
             var dt = DBAccess.RunSQLReturnJSON(sql);*/


            data = JSON.parse(data);

            var left = "";
            for (var i = 0; i < data.length; i++) {
                var group = data[i];
                left += "<tr><td><a href='javascript:ShowFlows(\"" + group.FK_Flow + "\");'>" + group.FlowName + "（" + group.Num + "）</a></td></tr>";
            }
            $('#left').html(left);

            $('#docs').html("请选择流程。。。");


            //绑定流程.
            ShowFlows(GetQueryString("FK_Flow"));
        }

        function ShowFlows(flowNo) {
            debugger;

            if (flowNo == null || flowNo == undefined) {
                //输出流程.
                $('#docs').html("欢迎使用流程监控，您所能看到的流程");
            }

            var html = "<table class='table table-bordered table-hover'>";
            html += "<thead><tr>";
            html += "<th>序</th>";
            html += "<th>标题</th>";
            html += "<th>状态</th>";
            html += "<th>发起人</th>";
            html += "<th>发起日期</th>";
            html += "<th>停留节点</th>";
            html += "<th>处理人</th>";
            html += "</tr></thead>";

            var handler = new HttpHandler("BP.WF.HttpHandler.WF");
            handler.AddPara("FK_Flow", flowNo);
            var data = handler.DoMethodReturnJSON("Watchdog_InitFlows");

            for (var i = 0; i < data.length; i++) {

                var dt = data[i];

                html += "<tr>";
                html += "<td>" + (i + 1) + "</td>";
                html += "<td><a href=\"javascript:OpenIt('" + dt.WorkID + "','" + dt.FlowNo + "')\" >" + dt.Title + "</td>";
                html += "<td>" + dt.WFStateText + "</td>";
                html += "<td>" + dt.StarterName + "</td>";
                html += "<td>" + dt.RDT + "</td>";
                html += "<td>" + dt.NodeName + "</td>";
                html += "<td>" + dt.TodEmps + "</td>";
                html += "</tr>";
            }
            html += "</table>";
            html += "</div></div>";

            $('#docs').html(html);
        }

        function OpenIt(workID, flowNo) {

            var url = "WFRpt.htm?WorkID=" + workID + "&FK_Flow=" + flowNo;
            WinOpenFull(url);

            //window.location.href = 'Watchdog.htm?IsRef=1';
        }
    </script>
</head>
<body>
    <section class="content-header" style="margin-left: 20px;">
        <h2>
            流程监控
        </h2>

    </section>

    <div class="col-md-12">
        <div class="box col-md-3">

            <!-- /.box-header -->
            <div class="box-body">
                <table id="example2" class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>流程列表</th>
                        </tr>
                    </thead>
                    <tbody id="left">
                    </tbody>

                </table>
            </div>
            <!-- /.box-body -->
        </div>
        <!-- /.box -->

        <div class="box col-md-9">
            <div class="box-header">
                <h3 class="box-title">Hover Data Table</h3>

            </div>
            <!-- /.box-header -->
            <div class="box-body" id="docs">
               
            </div>
            <!-- /.box-body -->
        </div>
        <!-- /.box -->
    </div>

</body>
</html>