<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
    <link href="../Scripts/bootstrap/css/bootstrap.css" rel="Stylesheet"/>
    <link href="../../DataUser/Style/ccbpm.css" rel="Stylesheet" />
    <script type="text/javascript" src="../Scripts/QueryString.js"></script>
    <script src="../Scripts/jquery/jquery.min.js"></script>
    <script src="../Scripts/bootstrap/js/jquery.cokie.min.js"></script>
    <script src="../Scripts/QueryString2016.js"></script>
    
    <style>
        #mains {
            margin: 10px auto;
            background: #fff;
            /*border: 1px solid #ccc;*/
        } 
        #mains h3 {
            font-size: 20px;
            background: rgb(157, 159, 175) !important;
            color: white;
            padding: 10px;
            text-align: left;
            margin: 0px;

            display:none;
        }
            #mains fieldset legend {
                border-bottom: none;
                float: left;
            }
            #mains form {
                overflow: hidden;
            }
        #mains tr{
            height: 50px;
        }
        #mains tr td{
            padding: 0px 15px;
        }
            #mains form {
                background: #f4f9ff;
                padding: 10px;
                margin: 25px 15px;
                border: #2884fa 1px solid;
                border-radius: 20px !important;
            }
            #mains table{
                width: 100%;
                border: none;
              }
        #mains input, #mains textarea {
            border-radius: 15px;
            border: #2884fa 1px solid;
            margin: 8px 0px;
            line-height: 25px;
            padding-left: 6px;
            resize: none;
        }
            #mains tr td button {
                margin: 0px 5px;
                border-radius: 15px;
                background: #2884fa;
            }

        .yjback, yjother,.yjdele, .yj ,label[for=yjback],label[for=yjdele],label[for=yjother],label[for=yj]{
            cursor: pointer;
        }
    </style>
    <script>
        var pageData = {};
        $(function () {
            var selectEmpModalHtml = '<div class="modal fade" id="selectEmpsModal">' +
               '<div class="modal-dialog">'
                   + '<div class="modal-content" style="border-radius:0px;width:700px;">'
                      + '<div class="modal-header">'
                          + '<button type="button" class="close" style="color:white;opacity:1;" data-dismiss="modal" aria-hidden="true">&times;</button>'
                           + '<h4 class="modal-title">选择移交人</h4>'
                       + '</div>'
                       + '<div class="modal-body">'
                           + '<iframe style="width:100%;border:0px;height:400px;" id="iframeSelectEmpsForm" name="iframeSelectEmpsForm"></iframe>'
                       + '</div>'
                   + '</div><!-- /.modal-content -->'
               + '</div><!-- /.modal-dialog -->'
           + '</div>';

            $('body').append($(selectEmpModalHtml));
            $('#iframeSelectEmpsForm').attr('src', "SelectEmps.htm?FK_Dept=" + getQueryStringByNameFromUrl("?" + $.cookie('CCS'), "FK_Dept") + "&s=" + Math.random());

            $('#BtnSelectEmps').bind('click', function () {
                //$('#selectEmpsModal').modal().show();
                $('#selectEmpsModal').show().addClass("in");
            });
            $("#mains").show();
            $(".idea input").click(function () {
                if ($(".idea input:checked").val().split("_")[1] == "移交给其他人处理") {
                    $(".yjshow").show();
                } else {
                    $(".yjshow").hide();
                }
                var re = $(".idea input:checked").val().split("_")[1] + "原因";
                $("#sjre").text(re);

                setParentHeight();
            });
            pageData.FK_Flow=GetQueryString("FK_Flow");
            pageData.FK_Node=GetQueryString("FK_Node");
            pageData.WorkID=GetQueryString("WorkID");
            pageData.FID=GetQueryString("FID");
            msg();

            setParentHeight();
        });
        //设置父IFRAME 高度  适用于傻瓜表单
        function setParentHeight() {
            if (parent != null) {
                var height = document.body.clientHeight + 30;
                var currentForm = parent.document.getElementById('topContentDiv');
                //$(currentForm).height(height + 75);
                if (currentForm != undefined) {
                    $(currentForm).children('iframe').height(height);
                }
            }
        }
        function msg() {
            $.ajax({
                url: "Handler.ashx?DoType=DealSubThreadReturnToHL_Init&FK_Flow=" + pageData.FK_Flow + "&FK_Node="+pageData.FK_Node+"&WorkID="+pageData.WorkID+"&FID="+pageData.FID+"&m=" +
                    Math.random(),
                data: {},
                success: function(data) {
                    try{
                        data=JSON.parse(data);
                    }
                    catch(err){
                        alert("DealSubThreadReturnToHL_Init 返回值错误："+ data);
                    }
                    $("#mains h3").append(data.MsgInfo);

                    $("#mains h3").append("退回处理信息");
                    if (data.ThreadIsCanShift == 1) {//子线程可以移交
                        $('#yjother').show();
                        $('label[for=yjother]').show();
                    }
                    if (data.ThreadIsCanDel == 1) {//子线程可以删除
                        $('#yjdele').show();
                        $('label[for=yjdele]').show();
                    }
                    if (data.CancelRole == "1") {//未知

                    }
                }
            });
        }
        function save() {
            var actionType = $(".idea input:checked").val().split("_")[0];
            var note = $("#resj").val();
            var shiftToEmp = frames["iframeSelectEmpsForm"].window.returnVal.No;
            $.ajax({
                url: "Handler.ashx?DoType=DealSubThreadReturnToHL_Done&FK_Flow=" + pageData.FK_Flow + "&FK_Node="+pageData.FK_Node+"&WorkID="+pageData.WorkID+"&FID="+pageData.FID + "&ActionType=" + actionType + "&Note=" + note + "&ShiftToEmp=" + shiftToEmp + "&=m" + Math.random(),
                data: {},
                success: function (data) {
                    if (data != null) {
                        if (window.parent != null && window.parent.returnWorkWindowClose != null) {
                            window.parent.returnWorkWindowClose(data);
                        } else {
                            $("#mains h3").append(data);
                            window.close();
                        }
                    }
                }
            });
            $(".foot").hide();
        }
        function selectEmpsWindowClose(data) {
            //$('#selectEmpsModal').modal('hide');
            $('#selectEmpsModal').hide().removeClass("in");
            if (data == '取消') {
                return;
            } else {
                $('#ToEmp').val(frames["iframeSelectEmpsForm"].window.returnVal.Name);
            }
        }
        function Close() {
            if (window.parent != null && window.parent.returnWorkWindowClose != null) {
                window.parent.returnWorkWindowClose("取消");
            } else {
                $('body').append($('<div>' + "已取消操作" + '</div>'));
                window.close();
            }
        }
    </script>
</head>
<body style="margin: 0px; ">
    <div id="mains" style="display: none;" >
        <h3></h3>
        <div class="row" style="margin: 0px;">
            <!--<tr>
            <td colspan="2">
                <fieldset>
                    <legend>&nbsp; 来自节点:</legend>
                </fieldset>
            </td>
        </tr>-->
            <div class="idea">
                <div class="col-md-3" style="text-align: right;padding-top:6px;">处理方式</div>
                <div class="col-md-9" style="text-align: left;">
                    <input type="radio" name="radio1" value="Return_退回给子线程处理人" class="yjback" id="yjback" checked /><label for="yjback">
                        退回给子线程处理人
                    </label>
                    <input id="yjother" style="display:none;" type="radio" name="radio1" value="Shift_移交给其他人处理" class="yjother" /><label for="yjother" style="display:none;"> 移交给其他人处理</label>
                    <input type="radio" name="radio1" style="display:none;" value="Kill_删除子线程" class="yjdele" id="yjdele" /><label for="yjdele" style="display:none;">
                        删除子线程
                    </label>
                    <input type="radio" name="radio1" value="UnSend_撤销分流点发送" class="yj" id="yj" /><label for="yj">撤销分流点发送</label>
                </div>
            </div>
            <div class="yjshow " style="display:none;">
                <div class=" col-md-3" style="text-align:right;padding-top:6px;">移交人</div>
                <div class="col-md-9" style="text-align:left;">
                    <input type="text" id="ToEmp" name="ToEmp" value='' disabled /> <input type="button" id="BtnSelectEmps" value='选择接受人' style="position: absolute; right: 15px; top: 1px; border-radius: 0px 25px 25px 0px;padding-top:0px; height: 27px; background: #2884fa; color: #fff;" />
                </div>
            </div>
            <div class="">
                <div class="col-md-3" style="text-align: right;padding-top:6px;" id="sjre">退回给子线程处理人处理原因</div>
                <div class="col-md-9"><textarea id="resj" style="width:100%;"></textarea></div>
            </div>
            <div class="foot col-md-12" style="text-align: right;">
                <button class="btn btn-info" onclick="save()">确定</button>
                <button class="btn btn-info" onclick="Close()">取消</button>
            </div>
        </div>
    </div>
</body>
</html>
