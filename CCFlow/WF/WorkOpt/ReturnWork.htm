<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>退回</title>
    <!--
    1, 退回界面。
    2，需要 FK_Flow, FK_Node,WorkID, FID.
    3, 调用方法 ReturnWork.htm?FK_Flow=001&FK_Node=103&WorkID=232&FID=23
    -->
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <script type="text/javascript" src="../Scripts/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="../Scripts/QueryString.js"></script>

    <link href="../Scripts/bootstrap/css/bootstrap.css" rel="Stylesheet" type="text/css" />
    <link href="../../DataUser/Style/ccbpm.css" rel="Stylesheet" />
    <style type="text/css">
        #TB_ReturnReason
        {
            height: 150px;
            width: 100%;
        }

        body {
            background: transparent;
        }
    </style>
    <script type="text/javascript">
        $(function () {
            InitParam();

            InitReturnMsg();
        });
        var pageData = {};
        function InitParam() {
            pageData.FID = GetQueryString("FID");
            pageData.WorkID = GetQueryString("WorkID");
            pageData.FK_Node = GetQueryString("FK_Node");
            pageData.FK_Flow = GetQueryString("FK_Flow");

        }
        //确定 退回 执行退回操作
        function ReturnWork() {
            //WorkID, this.FID, this.FK_Node
            $.ajax({
                type: 'post',
                async: true,
                data: pageData,
                url: "../MyFlow.ashx?Method=DoReturnWork&m=" + Math.random() + "&ReturnToNode=" + $('#DDL_Nodes option:checked').val() + '&ReturnMsg=' + $('#TB_Doc').val(),
                dataType: 'html',
                success: function (data) {
                    if (window.parent != null && window.parent.returnWorkWindowClose != null) {
                        window.parent.returnWorkWindowClose(data);
                    }
                }
            });
        }

        //取消退回
        function Close() {
            if (window.parent != null && window.parent.returnWorkWindowClose != null) {
                window.parent.returnWorkWindowClose("取消");
            }
        }
        //初始化页面退回信息
        function InitReturnMsg() {
            var param = pageData;
            $.ajax({
                type: 'post',
                async: true,
                data: param,
                url: "../MyFlow.ashx?Method=ReturnToNodes&m=" + Math.random(),
                dataType: 'html',
                success: function (data) {
                    var returnNodeArr = JSON.parse(data);
                    var DDL_NodesHtml = '';
                    $.each(returnNodeArr, function (i, returnNode) {
                        DDL_NodesHtml += '<option selected="selected" value="' + returnNode.No + '">' + returnNode.Name + '=&gt;' + returnNode.RecName + '</option>';
                    });
                    $('#DDL_Nodes').html(DDL_NodesHtml);
                }
            });
        }
    </script>
</head>
<body>
    <div>
        <div>
            <label style="width:200px;"> 请选择要退回到的节点:</label>
            <select id="DDL_Nodes" name="DDL_Nodes"></select>
        </div>
        <div>
            <label>退回原因：</label></div>
        <div>
            <textarea id="TB_ReturnReason" name="TB_Doc"></textarea>
        </div>
        <div>
            <label>上传附件：</label>
        </div>
        <div>
            预留
        </div>
        <div style="text-align:right;">
            <input type="button" value="确定退回" onclick="ReturnWork();" /><input type="button" value="关闭" onclick="Close();" />
        </div>
    </div>
</body>
</html>
